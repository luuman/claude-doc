<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced-features/plan-mode" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Plan 模式（规划模式） | Claude Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/claude-doc/docs/advanced-features/plan-mode"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Plan 模式（规划模式） | Claude Docs"><meta data-rh="true" name="description" content="掌握 Claude Code 的 Plan 模式，先思考后行动，大幅减少复杂任务的返工成本"><meta data-rh="true" property="og:description" content="掌握 Claude Code 的 Plan 模式，先思考后行动，大幅减少复杂任务的返工成本"><link data-rh="true" rel="icon" href="/claude-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/claude-doc/docs/advanced-features/plan-mode"><link data-rh="true" rel="alternate" href="https://luuman.github.io/claude-doc/docs/advanced-features/plan-mode" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/claude-doc/docs/advanced-features/plan-mode" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Plan 模式（规划模式）","item":"https://luuman.github.io/claude-doc/docs/advanced-features/plan-mode"}]}</script><link rel="alternate" type="application/rss+xml" href="/claude-doc/blog/rss.xml" title="Claude Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/claude-doc/blog/atom.xml" title="Claude Docs Atom Feed"><link rel="stylesheet" href="/claude-doc/assets/css/styles.b961a2e4.css">
<script src="/claude-doc/assets/js/runtime~main.b2563310.js" defer="defer"></script>
<script src="/claude-doc/assets/js/main.906b66fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/claude-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Claude</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/moltbot-doc/docs" class="dropdownMenuItem_VBaP">Moltbot</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/claude-doc/docs">Docs</a><a class="navLink_RnnM" href="/claude-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/claude-doc/docs"><span title="Claude Code 完全指南" class="linkLabel_WmDU">Claude Code 完全指南</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/claude-doc/docs/getting-started"><span title="快速开始" class="linkLabel_WmDU">快速开始</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/claude-doc/docs/core-concepts/skills"><span title="核心概念" class="categoryLinkLabel_W154">核心概念</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/skills"><span title="Skills（技能包）" class="linkLabel_WmDU">Skills（技能包）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/hooks"><span title="Hooks（钩子）" class="linkLabel_WmDU">Hooks（钩子）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/plugins"><span title="Plugins（插件）" class="linkLabel_WmDU">Plugins（插件）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/mcp-servers"><span title="MCP Servers（模型上下文协议）" class="linkLabel_WmDU">MCP Servers（模型上下文协议）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/subagents"><span title="Subagents（子代理）" class="linkLabel_WmDU">Subagents（子代理）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/claude-md"><span title="CLAUDE.md（项目记忆文件）" class="linkLabel_WmDU">CLAUDE.md（项目记忆文件）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/memory"><span title="Memory（自动记忆）" class="linkLabel_WmDU">Memory（自动记忆）</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/claude-doc/docs/advanced-features/plan-mode"><span title="高级功能" class="categoryLinkLabel_W154">高级功能</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/claude-doc/docs/advanced-features/plan-mode"><span title="Plan 模式（规划模式）" class="linkLabel_WmDU">Plan 模式（规划模式）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/headless-mode"><span title="Headless 模式（无头模式）" class="linkLabel_WmDU">Headless 模式（无头模式）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/slash-commands"><span title="自定义斜杠命令" class="linkLabel_WmDU">自定义斜杠命令</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/agent-sdk"><span title="Claude Agent SDK" class="linkLabel_WmDU">Claude Agent SDK</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/ide-integration"><span title="IDE 集成" class="linkLabel_WmDU">IDE 集成</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/vibecraft"><span title="VibeCraft — Claude Code 3D 可视化" class="linkLabel_WmDU">VibeCraft — Claude Code 3D 可视化</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/claude-doc/docs/best-practices/workflow"><span title="最佳实践" class="categoryLinkLabel_W154">最佳实践</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/best-practices/workflow"><span title="工作流最佳实践" class="linkLabel_WmDU">工作流最佳实践</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/best-practices/performance"><span title="性能优化" class="linkLabel_WmDU">性能优化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/best-practices/security"><span title="安全与故障排查" class="linkLabel_WmDU">安全与故障排查</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/claude-doc/docs/category/真实场景案例库"><span title="真实场景案例库" class="categoryLinkLabel_W154">真实场景案例库</span></a><button aria-label="折叠侧边栏分类 &#x27;真实场景案例库&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases"><span title="真实场景案例库" class="linkLabel_WmDU">真实场景案例库</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/frontend-acceleration"><span title="React 项目加速" class="linkLabel_WmDU">React 项目加速</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/ui-components"><span title="UI 组件库自动化" class="linkLabel_WmDU">UI 组件库自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/backend-api"><span title="API 快速开发" class="linkLabel_WmDU">API 快速开发</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/database-migration"><span title="数据库迁移和优化" class="linkLabel_WmDU">数据库迁移和优化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/cicd-automation"><span title="CI/CD 流程自动化" class="linkLabel_WmDU">CI/CD 流程自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/infrastructure-as-code"><span title="基础设施即代码（IaC）" class="linkLabel_WmDU">基础设施即代码（IaC）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/api-documentation"><span title="API 文档自动化" class="linkLabel_WmDU">API 文档自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/technical-writing"><span title="技术文档写作" class="linkLabel_WmDU">技术文档写作</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/code-review"><span title="代码审查自动化" class="linkLabel_WmDU">代码审查自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/knowledge-base"><span title="知识库维护" class="linkLabel_WmDU">知识库维护</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/claude-doc/docs/quick-reference"><span title="速查手册" class="linkLabel_WmDU">速查手册</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/claude-doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">高级功能</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Plan 模式（规划模式）</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Plan 模式（规划模式）</h1></header>
<p>import Tabs from &#x27;@theme/Tabs&#x27;;
import TabItem from &#x27;@theme/TabItem&#x27;;</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>核心理念</div><div class="admonitionContent_BuS1"><p>Plan 模式体现了 <strong>&quot;Think before you act&quot;</strong> 的工程哲学。在开始执行任何代码变更之前，Claude 会先深入理解问题、制定详细计划并获得你的确认。这对于复杂任务尤为关键——一次好的规划胜过十次盲目的尝试。</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="进入-plan-模式">进入 Plan 模式<a href="#进入-plan-模式" class="hash-link" aria-label="进入 Plan 模式的直接链接" title="进入 Plan 模式的直接链接" translate="no">​</a></h2>
<p>有两种方式可以进入 Plan 模式：</p>

























<table><thead><tr><th>方式</th><th>操作</th><th>适用场景</th></tr></thead><tbody><tr><td>键盘快捷键</td><td>连按两次 <code>Shift + Tab</code></td><td>交互式会话中快速切换</td></tr><tr><td>斜杠命令</td><td>输入 <code>/plan</code></td><td>明确指定规划模式</td></tr><tr><td>前缀提示词</td><td>在请求前加 <code>&quot;请先制定计划...&quot;</code></td><td>临时性规划需求</td></tr></tbody></table>
<p>进入 Plan 模式后，Claude 的回复界面会显示 <strong>[PLAN MODE]</strong> 标识，且不会执行任何实际的文件修改操作，直到你明确批准计划。</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="工作流程4-个阶段">工作流程：4 个阶段<a href="#工作流程4-个阶段" class="hash-link" aria-label="工作流程：4 个阶段的直接链接" title="工作流程：4 个阶段的直接链接" translate="no">​</a></h2>
<p>Plan 模式将复杂任务分解为清晰的 4 个阶段，每个阶段都有明确的产出物。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">│   阶段 1      阶段 2      阶段 3      阶段 4               │</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">│   探索  ──→  规划  ──→  确认  ──→  执行                   │</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">│   (只读)    (设计)    (反馈)    (实施)                     │</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="阶段-1探索阶段exploration">阶段 1：探索阶段（Exploration）<a href="#阶段-1探索阶段exploration" class="hash-link" aria-label="阶段 1：探索阶段（Exploration）的直接链接" title="阶段 1：探索阶段（Exploration）的直接链接" translate="no">​</a></h3>
<p>Claude 进入只读模式，全面分析代码库：</p>
<ul>
<li class=""><strong>读取相关文件</strong> — 理解现有代码结构</li>
<li class=""><strong>分析依赖关系</strong> — 梳理模块间的调用链路</li>
<li class=""><strong>识别约束条件</strong> — 发现潜在的技术限制</li>
<li class=""><strong>搜索相似实现</strong> — 参考已有模式和惯例</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>探索阶段特点</div><div class="admonitionContent_BuS1"><p>此阶段 Claude <strong>不会修改任何文件</strong>。所有操作均为只读：<code>Read</code>、<code>Glob</code>、<code>Grep</code>、<code>Bash</code>（查询类）。</p></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[探索阶段输出示例]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ 已读取 src/auth/ 目录（12 个文件）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ 分析依赖：express, passport, jsonwebtoken, bcrypt</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ 发现现有用户模型：src/models/User.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ 识别路由结构：src/routes/*.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ 检查测试覆盖：tests/auth.test.ts（当前覆盖率 45%）</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="阶段-2规划阶段planning">阶段 2：规划阶段（Planning）<a href="#阶段-2规划阶段planning" class="hash-link" aria-label="阶段 2：规划阶段（Planning）的直接链接" title="阶段 2：规划阶段（Planning）的直接链接" translate="no">​</a></h3>
<p>基于探索结果，Claude 设计完整的实现方案：</p>
<ul>
<li class=""><strong>拆解任务步骤</strong> — 将目标分解为原子操作</li>
<li class=""><strong>评估影响范围</strong> — 列出所有需要修改的文件</li>
<li class=""><strong>识别潜在风险</strong> — 提前标记可能出现的问题</li>
<li class=""><strong>估算工作量</strong> — 给出大致的操作数量</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="阶段-3确认阶段confirmation">阶段 3：确认阶段（Confirmation）<a href="#阶段-3确认阶段confirmation" class="hash-link" aria-label="阶段 3：确认阶段（Confirmation）的直接链接" title="阶段 3：确认阶段（Confirmation）的直接链接" translate="no">​</a></h3>
<p>Claude 将规划结果以结构化格式展示，等待你的反馈：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token title important punctuation" style="color:#C792EA">##</span><span class="token title important" style="color:#D6DEEB"> 实现计划：用户认证功能</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">###</span><span class="token title important" style="color:#D6DEEB"> 将要修改的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">1.</span><span class="token plain"> src/models/User.ts - 添加密码哈希字段</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">2.</span><span class="token plain"> src/routes/auth.ts  - 新建认证路由（登录/注册/登出）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">3.</span><span class="token plain"> src/middleware/auth.ts - JWT 验证中间件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">4.</span><span class="token plain"> src/config/passport.ts - Passport 策略配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">5.</span><span class="token plain"> tests/auth.test.ts - 补充测试用例</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">###</span><span class="token title important" style="color:#D6DEEB"> 将要创建的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> src/utils/jwt.ts - JWT 工具函数</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> src/types/auth.ts - 类型定义</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">###</span><span class="token title important" style="color:#D6DEEB"> 潜在风险</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">⚠️ User.ts 修改需要同步更新数据库迁移脚本</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">⚠️ 现有的 API 路由可能需要添加认证守卫</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">是否按此计划执行？(y/n 或提出修改意见)</span><br></span></code></pre></div></div>
<p>你可以：</p>
<ul>
<li class="">输入 <code>y</code> 或 <code>yes</code> — 批准计划，进入执行阶段</li>
<li class="">提出修改意见 — Claude 将调整计划后再次确认</li>
<li class="">输入 <code>n</code> — 取消，重新讨论需求</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="阶段-4执行阶段execution">阶段 4：执行阶段（Execution）<a href="#阶段-4执行阶段execution" class="hash-link" aria-label="阶段 4：执行阶段（Execution）的直接链接" title="阶段 4：执行阶段（Execution）的直接链接" translate="no">​</a></h3>
<p>计划获批后，Claude 按序执行每个步骤：</p>
<ul>
<li class=""><strong>严格按计划实施</strong> — 不会执行计划外的操作</li>
<li class=""><strong>实时反馈进度</strong> — 每完成一步都会汇报</li>
<li class=""><strong>处理意外情况</strong> — 遇到问题暂停并请示</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="完整使用示例实现用户认证功能">完整使用示例：实现用户认证功能<a href="#完整使用示例实现用户认证功能" class="hash-link" aria-label="完整使用示例：实现用户认证功能的直接链接" title="完整使用示例：实现用户认证功能的直接链接" translate="no">​</a></h2>
<p>以下是一个真实场景的完整演示，展示 Plan 模式在复杂功能开发中的应用。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="第-1-步启动-plan-模式">第 1 步：启动 Plan 模式<a href="#第-1-步启动-plan-模式" class="hash-link" aria-label="第 1 步：启动 Plan 模式的直接链接" title="第 1 步：启动 Plan 模式的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 在 Claude Code 交互界面中</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输入需求后，按两次 Shift+Tab 进入 Plan 模式</span><br></span></code></pre></div></div>
<p><strong>用户输入：</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">为我们的 Express 应用实现完整的用户认证功能，</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">包括注册、登录、JWT token 管理和路由保护</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="第-2-步claude-探索代码库">第 2 步：Claude 探索代码库<a href="#第-2-步claude-探索代码库" class="hash-link" aria-label="第 2 步：Claude 探索代码库的直接链接" title="第 2 步：Claude 探索代码库的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[Plan Mode - 探索阶段]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">正在分析代码库结构...</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">├── 读取 package.json → 发现依赖: express@4.18, mongoose@7.x</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">├── 扫描 src/ 目录 → 12 个源文件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">├── 读取 src/models/User.ts → 当前仅有 name, email 字段</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">├── 读取 src/routes/index.ts → 4 个现有路由</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">├── 读取 src/app.ts → 中间件配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">└── 检查 .env.example → 已有 MONGODB_URI, PORT 变量</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">探索完成。未发现现有认证实现。</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="第-3-步claude-展示规划方案">第 3 步：Claude 展示规划方案<a href="#第-3-步claude-展示规划方案" class="hash-link" aria-label="第 3 步：Claude 展示规划方案的直接链接" title="第 3 步：Claude 展示规划方案的直接链接" translate="no">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[Plan Mode - 规划方案]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">##</span><span class="token title important" style="color:#D6DEEB"> 用户认证系统实现计划</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">###</span><span class="token title important" style="color:#D6DEEB"> 新增依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> bcryptjs     → 密码哈希</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> jsonwebtoken → JWT 生成与验证</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> express-validator → 输入验证</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">###</span><span class="token title important" style="color:#D6DEEB"> 文件变更清单（共 8 处）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token bold punctuation" style="color:#C792EA">**</span><span class="token bold content">修改现有文件：</span><span class="token bold punctuation" style="color:#C792EA">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">1.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/models/User.ts`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">   </span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> 添加 </span><span class="token code-snippet code keyword" style="color:#C792EA">`password`</span><span class="token plain"> 字段（哈希存储）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">   </span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> 添加 </span><span class="token code-snippet code keyword" style="color:#C792EA">`createdAt`</span><span class="token plain">, </span><span class="token code-snippet code keyword" style="color:#C792EA">`updatedAt`</span><span class="token plain"> 时间戳</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">   </span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> 添加 </span><span class="token code-snippet code keyword" style="color:#C792EA">`comparePassword()`</span><span class="token plain"> 实例方法</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">2.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/app.ts`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">   </span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> 挂载 /api/auth 路由</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">3.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`.env.example`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">   </span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> 添加 JWT_SECRET, JWT_EXPIRES_IN 变量</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token bold punctuation" style="color:#C792EA">**</span><span class="token bold content">新建文件：</span><span class="token bold punctuation" style="color:#C792EA">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">4.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/routes/auth.ts`</span><span class="token plain">       → POST /register, POST /login, POST /logout</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">5.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/middleware/auth.ts`</span><span class="token plain">   → JWT 验证中间件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">6.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/utils/jwt.ts`</span><span class="token plain">         → token 生成/验证工具</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">7.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/types/auth.ts`</span><span class="token plain">        → TypeScript 类型定义</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">8.</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`tests/auth.test.ts`</span><span class="token plain">       → 认证功能单元测试</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token title important punctuation" style="color:#C792EA">###</span><span class="token title important" style="color:#D6DEEB"> 风险提示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">⚠️ 需要确保 JWT_SECRET 在生产环境中使用足够复杂的密钥</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">⚠️ 建议在 User 模型变更后运行数据库迁移</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token bold punctuation" style="color:#C792EA">**</span><span class="token bold content">预计操作：</span><span class="token bold punctuation" style="color:#C792EA">**</span><span class="token plain"> 约 150 行新增代码，修改 3 个现有文件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token hr punctuation" style="color:#C792EA">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">批准此计划？直接输入 y 开始执行，或说明需要调整的内容。</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="第-4-步用户调整计划">第 4 步：用户调整计划<a href="#第-4-步用户调整计划" class="hash-link" aria-label="第 4 步：用户调整计划的直接链接" title="第 4 步：用户调整计划的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">用户：计划看起来不错，但请把 logout 功能改为 token 黑名单机制，</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">     而不是单纯的客户端清除。</span><br></span></code></pre></div></div>
<p>Claude 调整后重新确认：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[已更新计划]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">调整内容：</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> 新增 </span><span class="token code-snippet code keyword" style="color:#C792EA">`src/models/TokenBlacklist.ts`</span><span class="token plain"> → 存储已失效的 token</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`POST /logout`</span><span class="token plain"> 将把当前 token 加入黑名单</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token list punctuation" style="color:#C792EA">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#C792EA">`auth.ts`</span><span class="token plain"> 中间件将检查 token 黑名单</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">其余计划保持不变。确认执行？</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="第-5-步执行阶段">第 5 步：执行阶段<a href="#第-5-步执行阶段" class="hash-link" aria-label="第 5 步：执行阶段的直接链接" title="第 5 步：执行阶段的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[Plan Mode - 执行阶段]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [1/9] 安装依赖: npm install bcryptjs jsonwebtoken express-validator</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [2/9] 更新 src/models/User.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [3/9] 创建 src/models/TokenBlacklist.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [4/9] 创建 src/utils/jwt.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [5/9] 创建 src/types/auth.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [6/9] 创建 src/routes/auth.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [7/9] 创建 src/middleware/auth.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [8/9] 更新 src/app.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">✓ [9/9] 创建 tests/auth.test.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">所有步骤执行完成。</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">运行 npm test 验证实现是否正确。</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="为什么-plan-模式至关重要">为什么 Plan 模式至关重要<a href="#为什么-plan-模式至关重要" class="hash-link" aria-label="为什么 Plan 模式至关重要的直接链接" title="为什么 Plan 模式至关重要的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="减少返工的数据支撑">减少返工的数据支撑<a href="#减少返工的数据支撑" class="hash-link" aria-label="减少返工的数据支撑的直接链接" title="减少返工的数据支撑的直接链接" translate="no">​</a></h3>
<p>在没有规划的情况下，Claude 直接执行复杂任务时的典型问题：</p>






























<table><thead><tr><th>场景</th><th>无规划</th><th>有规划</th></tr></thead><tbody><tr><td>理解偏差</td><td>实现一半发现方向错误</td><td>确认阶段提前纠偏</td></tr><tr><td>文件遗漏</td><td>忘记更新相关配置文件</td><td>规划阶段列出全部影响</td></tr><tr><td>技术债务</td><td>为赶进度引入不良实践</td><td>设计阶段评估最优方案</td></tr><tr><td>沟通成本</td><td>反复修改浪费 token</td><td>一次规划对齐预期</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="适合使用-plan-模式的场景">适合使用 Plan 模式的场景<a href="#适合使用-plan-模式的场景" class="hash-link" aria-label="适合使用 Plan 模式的场景的直接链接" title="适合使用 Plan 模式的场景的直接链接" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>强烈推荐使用 Plan 模式</div><div class="admonitionContent_BuS1"><ul>
<li class="">新功能开发（超过 3 个文件的变更）</li>
<li class="">重构现有代码（架构层面的调整）</li>
<li class="">数据库 Schema 变更</li>
<li class="">API 接口设计</li>
<li class="">引入新的第三方依赖</li>
<li class="">安全相关的功能实现</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>可以跳过 Plan 模式</div><div class="admonitionContent_BuS1"><ul>
<li class="">简单的 Bug 修复（单文件、定位明确）</li>
<li class="">格式化或注释更新</li>
<li class="">配置文件的微小调整</li>
<li class="">已有明确方案的重复性任务</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="plan-模式的本质价值">Plan 模式的本质价值<a href="#plan-模式的本质价值" class="hash-link" aria-label="Plan 模式的本质价值的直接链接" title="Plan 模式的本质价值的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">没有 Plan 模式的开发流程：</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">需求 → 立即执行 → 发现问题 → 回滚 → 重新执行 → ...（循环）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">使用 Plan 模式的开发流程：</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">需求 → 探索 → 规划 → 确认对齐 → 一次执行到位</span><br></span></code></pre></div></div>
<p>Plan 模式不仅节省了 token 消耗，更重要的是通过<strong>强制的预思考环节</strong>，让 Claude 和你在执行前就达成对目标的一致理解，从根本上避免了方向性错误。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/claude-doc/docs/core-concepts/memory"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Memory（自动记忆）</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/claude-doc/docs/advanced-features/headless-mode"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Headless 模式（无头模式）</div></a></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#进入-plan-模式" class="table-of-contents__link toc-highlight">进入 Plan 模式</a></li><li><a href="#工作流程4-个阶段" class="table-of-contents__link toc-highlight">工作流程：4 个阶段</a><ul><li><a href="#阶段-1探索阶段exploration" class="table-of-contents__link toc-highlight">阶段 1：探索阶段（Exploration）</a></li><li><a href="#阶段-2规划阶段planning" class="table-of-contents__link toc-highlight">阶段 2：规划阶段（Planning）</a></li><li><a href="#阶段-3确认阶段confirmation" class="table-of-contents__link toc-highlight">阶段 3：确认阶段（Confirmation）</a></li><li><a href="#阶段-4执行阶段execution" class="table-of-contents__link toc-highlight">阶段 4：执行阶段（Execution）</a></li></ul></li><li><a href="#完整使用示例实现用户认证功能" class="table-of-contents__link toc-highlight">完整使用示例：实现用户认证功能</a><ul><li><a href="#第-1-步启动-plan-模式" class="table-of-contents__link toc-highlight">第 1 步：启动 Plan 模式</a></li><li><a href="#第-2-步claude-探索代码库" class="table-of-contents__link toc-highlight">第 2 步：Claude 探索代码库</a></li><li><a href="#第-3-步claude-展示规划方案" class="table-of-contents__link toc-highlight">第 3 步：Claude 展示规划方案</a></li><li><a href="#第-4-步用户调整计划" class="table-of-contents__link toc-highlight">第 4 步：用户调整计划</a></li><li><a href="#第-5-步执行阶段" class="table-of-contents__link toc-highlight">第 5 步：执行阶段</a></li></ul></li><li><a href="#为什么-plan-模式至关重要" class="table-of-contents__link toc-highlight">为什么 Plan 模式至关重要</a><ul><li><a href="#减少返工的数据支撑" class="table-of-contents__link toc-highlight">减少返工的数据支撑</a></li><li><a href="#适合使用-plan-模式的场景" class="table-of-contents__link toc-highlight">适合使用 Plan 模式的场景</a></li><li><a href="#plan-模式的本质价值" class="table-of-contents__link toc-highlight">Plan 模式的本质价值</a></li></ul></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Claude Docs.</div></div></div></footer></div>
</body>
</html>