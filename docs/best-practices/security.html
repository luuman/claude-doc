<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-best-practices/security" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">安全与故障排查 | Claude Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/claude-doc/docs/best-practices/security"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="安全与故障排查 | Claude Docs"><meta data-rh="true" name="description" content="Claude Code 安全配置最佳实践，以及常见问题的诊断与解决方案"><meta data-rh="true" property="og:description" content="Claude Code 安全配置最佳实践，以及常见问题的诊断与解决方案"><link data-rh="true" rel="icon" href="/claude-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/claude-doc/docs/best-practices/security"><link data-rh="true" rel="alternate" href="https://luuman.github.io/claude-doc/docs/best-practices/security" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/claude-doc/docs/best-practices/security" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"安全与故障排查","item":"https://luuman.github.io/claude-doc/docs/best-practices/security"}]}</script><link rel="alternate" type="application/rss+xml" href="/claude-doc/blog/rss.xml" title="Claude Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/claude-doc/blog/atom.xml" title="Claude Docs Atom Feed"><link rel="stylesheet" href="/claude-doc/assets/css/styles.b961a2e4.css">
<script src="/claude-doc/assets/js/runtime~main.b2563310.js" defer="defer"></script>
<script src="/claude-doc/assets/js/main.906b66fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/claude-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Claude</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/moltbot-doc/docs" class="dropdownMenuItem_VBaP">Moltbot</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/claude-doc/docs">Docs</a><a class="navLink_RnnM" href="/claude-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/claude-doc/docs"><span title="Claude Code 完全指南" class="linkLabel_WmDU">Claude Code 完全指南</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/claude-doc/docs/getting-started"><span title="快速开始" class="linkLabel_WmDU">快速开始</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/claude-doc/docs/core-concepts/skills"><span title="核心概念" class="categoryLinkLabel_W154">核心概念</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/skills"><span title="Skills（技能包）" class="linkLabel_WmDU">Skills（技能包）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/hooks"><span title="Hooks（钩子）" class="linkLabel_WmDU">Hooks（钩子）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/plugins"><span title="Plugins（插件）" class="linkLabel_WmDU">Plugins（插件）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/mcp-servers"><span title="MCP Servers（模型上下文协议）" class="linkLabel_WmDU">MCP Servers（模型上下文协议）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/subagents"><span title="Subagents（子代理）" class="linkLabel_WmDU">Subagents（子代理）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/claude-md"><span title="CLAUDE.md（项目记忆文件）" class="linkLabel_WmDU">CLAUDE.md（项目记忆文件）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/core-concepts/memory"><span title="Memory（自动记忆）" class="linkLabel_WmDU">Memory（自动记忆）</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/claude-doc/docs/advanced-features/plan-mode"><span title="高级功能" class="categoryLinkLabel_W154">高级功能</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/plan-mode"><span title="Plan 模式（规划模式）" class="linkLabel_WmDU">Plan 模式（规划模式）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/headless-mode"><span title="Headless 模式（无头模式）" class="linkLabel_WmDU">Headless 模式（无头模式）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/slash-commands"><span title="自定义斜杠命令" class="linkLabel_WmDU">自定义斜杠命令</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/agent-sdk"><span title="Claude Agent SDK" class="linkLabel_WmDU">Claude Agent SDK</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/ide-integration"><span title="IDE 集成" class="linkLabel_WmDU">IDE 集成</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/advanced-features/vibecraft"><span title="VibeCraft — Claude Code 3D 可视化" class="linkLabel_WmDU">VibeCraft — Claude Code 3D 可视化</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/claude-doc/docs/best-practices/workflow"><span title="最佳实践" class="categoryLinkLabel_W154">最佳实践</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/best-practices/workflow"><span title="工作流最佳实践" class="linkLabel_WmDU">工作流最佳实践</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/best-practices/performance"><span title="性能优化" class="linkLabel_WmDU">性能优化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/claude-doc/docs/best-practices/security"><span title="安全与故障排查" class="linkLabel_WmDU">安全与故障排查</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/claude-doc/docs/category/真实场景案例库"><span title="真实场景案例库" class="categoryLinkLabel_W154">真实场景案例库</span></a><button aria-label="折叠侧边栏分类 &#x27;真实场景案例库&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases"><span title="真实场景案例库" class="linkLabel_WmDU">真实场景案例库</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/frontend-acceleration"><span title="React 项目加速" class="linkLabel_WmDU">React 项目加速</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/ui-components"><span title="UI 组件库自动化" class="linkLabel_WmDU">UI 组件库自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/backend-api"><span title="API 快速开发" class="linkLabel_WmDU">API 快速开发</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/database-migration"><span title="数据库迁移和优化" class="linkLabel_WmDU">数据库迁移和优化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/cicd-automation"><span title="CI/CD 流程自动化" class="linkLabel_WmDU">CI/CD 流程自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/infrastructure-as-code"><span title="基础设施即代码（IaC）" class="linkLabel_WmDU">基础设施即代码（IaC）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/api-documentation"><span title="API 文档自动化" class="linkLabel_WmDU">API 文档自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/technical-writing"><span title="技术文档写作" class="linkLabel_WmDU">技术文档写作</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/code-review"><span title="代码审查自动化" class="linkLabel_WmDU">代码审查自动化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/claude-doc/docs/use-cases/knowledge-base"><span title="知识库维护" class="linkLabel_WmDU">知识库维护</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/claude-doc/docs/quick-reference"><span title="速查手册" class="linkLabel_WmDU">速查手册</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/claude-doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">最佳实践</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">安全与故障排查</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>安全与故障排查</h1></header>
<p>安全是使用 AI 编程助手的首要考量。本文介绍 Claude Code 的安全配置体系，以及常见问题的系统化解决方案。</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全配置">安全配置<a href="#安全配置" class="hash-link" aria-label="安全配置的直接链接" title="安全配置的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sandbox-模式">Sandbox 模式<a href="#sandbox-模式" class="hash-link" aria-label="Sandbox 模式的直接链接" title="Sandbox 模式的直接链接" translate="no">​</a></h3>
<p>Sandbox 模式通过权限白名单/黑名单机制，精确控制 Claude Code 可以执行的操作，防止意外或恶意的文件/命令操作。</p>
<p><strong>配置方式一：交互式配置</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">/permissions</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 打开权限配置界面，可视化管理所有权限</span><br></span></code></pre></div></div>
<p><strong>配置方式二：直接编辑 settings.json</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token comment" style="color:#637777;font-style:italic">// .claude/settings.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;permissions&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;allow&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;bash&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;git *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;npm *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;npx *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;node *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;python *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;pytest *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;jest *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;tsc *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;eslint *&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;write&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;src/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;tests/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;docs/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;.claude/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;*.md&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;*.json&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;*.yaml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;read&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;**/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;deny&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;bash&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;rm -rf *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;sudo *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;chmod 777 *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;curl * | bash&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;wget * | sh&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;dd if=*&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;&gt; /dev/sda*&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;mkfs *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;fdisk *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;format *&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;write&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;/etc/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;/usr/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;/sys/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;/boot/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;~/.ssh/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;~/.aws/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;**/.env&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;**/*.key&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;**/*.pem&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;**/*.p12&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;**/secrets/**&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="最小权限原则配置示例">最小权限原则配置示例<a href="#最小权限原则配置示例" class="hash-link" aria-label="最小权限原则配置示例的直接链接" title="最小权限原则配置示例的直接链接" translate="no">​</a></h3>
<p>根据项目类型，使用最小必要权限：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token comment" style="color:#637777;font-style:italic">// 前端项目（极简配置）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;permissions&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;allow&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;bash&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;npm *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;npx *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;git *&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;write&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;src/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;public/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;tests/**&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;read&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;**/*&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;deny&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;bash&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;rm -rf *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;sudo *&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;write&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;.env*&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;**/*.key&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/etc/**&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token comment" style="color:#637777;font-style:italic">// 后端项目（含数据库操作）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;permissions&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;allow&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;bash&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;npm *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;node *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;git *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;psql -h localhost *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">    </span><span class="token comment" style="color:#637777;font-style:italic">// 只允许本地数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;redis-cli -h localhost *&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;write&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;src/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;migrations/**&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;tests/**&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;read&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;**/*&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;deny&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;bash&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;psql -h production *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">   </span><span class="token comment" style="color:#637777;font-style:italic">// 禁止连接生产数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token string" style="color:#ECC48D">&quot;sudo *&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;rm -rf *&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;write&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;.env&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;**/*.key&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/etc/**&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>永远不要在生产环境运行 Claude Code</div><div class="admonitionContent_BuS1"><p>Claude Code 的所有操作都应该在开发/测试环境中进行。即使配置了严格的权限，也存在误操作风险。建议通过 CI/CD 流水线将经过审查的代码部署到生产环境。</p></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="hooks-安全检查">Hooks 安全检查<a href="#hooks-安全检查" class="hash-link" aria-label="Hooks 安全检查的直接链接" title="Hooks 安全检查的直接链接" translate="no">​</a></h3>
<p>通过 Hooks 机制，在 Claude 执行命令前进行安全校验：</p>
<p><strong>配置 Pre-execution Hook：</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token comment" style="color:#637777;font-style:italic">// .claude/settings.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;hooks&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;preExecution&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;.claude/hooks/security-check.sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p><strong>创建安全检查脚本：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># .claude/hooks/security-check.sh</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 在 Claude 执行 Bash 命令前进行安全检查</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">COMMAND=&quot;$1&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 定义危险命令黑名单</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">DANGEROUS_PATTERNS=(</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;rm -rf /&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;rm -rf ~&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;rm -rf \*&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;&gt; /dev/sd&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;mkfs\.&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;dd if=.*of=/dev/sd&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;curl.*| *sh&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;curl.*| *bash&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;wget.*| *sh&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;wget.*| *bash&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;sudo rm&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;chmod 777 /&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;chown.*root&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;:(){ :|:&amp; };:&quot;    # Fork bomb</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;base64 -d.*| *sh&quot; # 混淆执行</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">)</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查命令是否匹配危险模式</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">for pattern in &quot;${DANGEROUS_PATTERNS[@]}&quot;; do</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  if echo &quot;$COMMAND&quot; | grep -qE &quot;$pattern&quot;; then</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    echo &quot;❌ 安全检查失败: 检测到危险命令模式: $pattern&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    echo &quot;命令: $COMMAND&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    echo &quot;请手动确认是否需要执行此命令。&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    exit 1  # 返回非零值阻止执行</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">done</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查是否尝试操作敏感路径</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">SENSITIVE_PATHS=(</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;/etc/passwd&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;/etc/shadow&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;~/.ssh/id_rsa&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;~/.aws/credentials&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;.env&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">)</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">for path in &quot;${SENSITIVE_PATHS[@]}&quot;; do</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  if echo &quot;$COMMAND&quot; | grep -q &quot;$path&quot;; then</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    echo &quot;⚠️  警告: 命令涉及敏感文件路径: $path&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    echo &quot;命令: $COMMAND&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    read -p &quot;确认执行? (yes/no): &quot; confirm</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    if [ &quot;$confirm&quot; != &quot;yes&quot; ]; then</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      echo &quot;已取消执行。&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      exit 1</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    fi</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">done</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo &quot;✅ 安全检查通过&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">exit 0</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 设置脚本执行权限</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">chmod +x .claude/hooks/security-check.sh</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="敏感信息保护">敏感信息保护<a href="#敏感信息保护" class="hash-link" aria-label="敏感信息保护的直接链接" title="敏感信息保护的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="禁止事项">禁止事项<a href="#禁止事项" class="hash-link" aria-label="禁止事项的直接链接" title="禁止事项的直接链接" translate="no">​</a></h4>
<ul>
<li class="">将 <code>.env</code> 文件或 <code>secrets.json</code> 包含在 <code>@引用</code> 中</li>
<li class="">在提示词中直接粘贴 API Key、密码或私钥</li>
<li class="">让 Claude 将敏感信息写入版本控制文件</li>
<li class="">使用 Claude 处理包含真实用户数据的文件</li>
<li class="">将生产数据库连接字符串放入 <code>CLAUDE.md</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="推荐做法">推荐做法<a href="#推荐做法" class="hash-link" aria-label="推荐做法的直接链接" title="推荐做法的直接链接" translate="no">​</a></h4>
<ul>
<li class="">使用 <code>.env.example</code> 代替 <code>.env</code>（只包含变量名，不含值）</li>
<li class="">在 <code>.gitignore</code> 中确认 <code>.env*</code> 和 <code>*.key</code> 已排除</li>
<li class="">使用环境变量引用，而非硬编码：<code>process.env.API_KEY</code></li>
<li class="">对包含敏感字段的数据使用脱敏数据进行测试</li>
<li class="">定期轮换 Claude Code 使用的 API Key</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查是否有敏感信息意外提交</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">!git log --all --full-history -- &quot;**/.env&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">!git grep -l &quot;password\|secret\|api_key&quot; -- &quot;*.ts&quot; &quot;*.js&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 使用 git-secrets 防止意外提交</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">!git secrets --install</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">!git secrets --register-aws</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>一旦泄露，立即轮换</div><div class="admonitionContent_BuS1"><p>如果你意外地让 Claude 接触到了真实的 API Key 或密码，无论是否有实际泄露，都应该立即轮换该凭证。宁可多轮换一次，也不要承担安全风险。</p></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="常见问题与解决">常见问题与解决<a href="#常见问题与解决" class="hash-link" aria-label="常见问题与解决的直接链接" title="常见问题与解决的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="安装问题">安装问题<a href="#安装问题" class="hash-link" aria-label="安装问题的直接链接" title="安装问题的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q1npm-install--g-anthropic-aiclaude-code-安装失败">Q1：<code>npm install -g @anthropic-ai/claude-code</code> 安装失败<a href="#q1npm-install--g-anthropic-aiclaude-code-安装失败" class="hash-link" aria-label="q1npm-install--g-anthropic-aiclaude-code-安装失败的直接链接" title="q1npm-install--g-anthropic-aiclaude-code-安装失败的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> <code>EACCES: permission denied</code> 或 <code>npm ERR! code EINTEGRITY</code></p>
<p><strong>解决方案一：使用 sudo（快速但不推荐）</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">sudo npm install -g @anthropic-ai/claude-code</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 风险：可能影响系统 npm 目录权限</span><br></span></code></pre></div></div>
<p><strong>解决方案二：修改 npm 全局目录（推荐）</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 创建用户级 npm 目录</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">mkdir -p ~/.npm-global</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 配置 npm 使用新目录</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">npm config set prefix &#x27;~/.npm-global&#x27;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 添加到 PATH（添加到 ~/.bashrc 或 ~/.zshrc）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo &#x27;export PATH=~/.npm-global/bin:$PATH&#x27; &gt;&gt; ~/.zshrc</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">source ~/.zshrc</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 重新安装</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">npm install -g @anthropic-ai/claude-code</span><br></span></code></pre></div></div>
<p><strong>解决方案三：使用 nvm 管理 Node 版本（最佳实践）</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 安装 nvm</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">source ~/.bashrc</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 安装 LTS 版 Node</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">nvm install --lts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">nvm use --lts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 安装 Claude Code（无需 sudo）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">npm install -g @anthropic-ai/claude-code</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q2安装后-claude-命令未找到">Q2：安装后 <code>claude</code> 命令未找到<a href="#q2安装后-claude-命令未找到" class="hash-link" aria-label="q2安装后-claude-命令未找到的直接链接" title="q2安装后-claude-命令未找到的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> <code>bash: claude: command not found</code></p>
<p><strong>诊断步骤：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 确认 claude 已安装</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">npm list -g @anthropic-ai/claude-code</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 找到 npm 全局二进制目录</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">npm config get prefix</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出示例：/home/user/.npm-global</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 检查 PATH 是否包含该目录</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo $PATH | tr &#x27;:&#x27; &#x27;\n&#x27; | grep npm</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 如果不包含，手动添加</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo &#x27;export PATH=$(npm config get prefix)/bin:$PATH&#x27; &gt;&gt; ~/.zshrc</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">source ~/.zshrc</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 5. 验证</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">which claude</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --version</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="配置问题">配置问题<a href="#配置问题" class="hash-link" aria-label="配置问题的直接链接" title="配置问题的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q3模型配置不生效">Q3：模型配置不生效<a href="#q3模型配置不生效" class="hash-link" aria-label="Q3：模型配置不生效的直接链接" title="Q3：模型配置不生效的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> 设置了 <code>claude-opus-4-6</code> 但实际使用的是其他模型</p>
<p><strong>排查步骤：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 验证环境变量是否正确设置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo $ANTHROPIC_MODEL</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo $CLAUDE_MODEL</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 检查 settings.json 配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">cat .claude/settings.json | grep model</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 重启终端后再次检查</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">source ~/.zshrc</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo $ANTHROPIC_MODEL</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 使用 /status 命令检查当前配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/status</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出当前使用的模型、API Key 状态、权限配置等</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 5. 临时指定模型（用于测试）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --model claude-opus-4-6 &quot;测试模型配置&quot;</span><br></span></code></pre></div></div>
<p><strong>常见原因：</strong></p>
<ul>
<li class="">环境变量在当前 Shell 会话中未生效（需要 <code>source ~/.zshrc</code>）</li>
<li class=""><code>settings.json</code> 中的 <code>model</code> 字段与环境变量冲突（settings.json 优先级更高）</li>
<li class="">使用了不存在的模型 ID（检查 <a href="https://docs.anthropic.com/en/api/getting-started" target="_blank" rel="noopener noreferrer" class="">官方模型列表</a>）</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q4mcp-服务器无法连接">Q4：MCP 服务器无法连接<a href="#q4mcp-服务器无法连接" class="hash-link" aria-label="Q4：MCP 服务器无法连接的直接链接" title="Q4：MCP 服务器无法连接的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> <code>@mcp:github</code> 引用报错，或 MCP 功能不可用</p>
<p><strong>系统化排查流程：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 步骤 1：检查 MCP 服务器状态</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/mcp</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出所有已配置的 MCP 服务器及其连接状态</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 步骤 2：测试特定 MCP 服务器</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/mcp test github</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 执行连接测试并输出详细错误信息</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 步骤 3：查看 MCP 配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">cat .claude/mcp.json</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 步骤 4：重新安装问题 MCP</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude mcp remove github</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude mcp add github</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 或指定版本</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">npm install -g @modelcontextprotocol/server-github@latest</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 步骤 5：检查网络连接</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">curl -I https://api.github.com</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 如果失败，检查防火墙或代理设置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 步骤 6：运行全面诊断</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/doctor</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查所有组件的健康状态，输出详细诊断报告</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>/doctor 命令的作用</div><div class="admonitionContent_BuS1"><p><code>/doctor</code> 会检查：Node.js 版本、API Key 有效性、网络连接、MCP 服务器状态、权限配置、文件系统访问等。遇到疑难问题，首先运行 <code>/doctor</code>。</p></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用问题">使用问题<a href="#使用问题" class="hash-link" aria-label="使用问题的直接链接" title="使用问题的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q5上下文超出限制">Q5：上下文超出限制<a href="#q5上下文超出限制" class="hash-link" aria-label="Q5：上下文超出限制的直接链接" title="Q5：上下文超出限制的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> <code>Context length exceeded</code> 错误，或 Claude 开始&quot;遗忘&quot;之前的信息</p>
<p><strong>解决步骤：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 查看当前上下文使用情况</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/context</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出各部分 Token 占用，找出&quot;大户&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 压缩历史（推荐首选）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/compact</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 保留关键信息的摘要，清理冗余对话</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 如果 /compact 后仍然超限，清空上下文</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/clear</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 然后使用精确的 @引用 重建必要上下文</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 重建上下文时，只引用必要文件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">@src/auth/AuthService.ts @src/types/user.ts</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 而不是整个 @src/</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 5. 对于超大型任务，使用 Subagents</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 每个子代理处理一个独立模块，避免单个上下文过大</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --agent user-module &quot;处理用户模块...&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --agent payment-module &quot;处理支付模块...&quot;</span><br></span></code></pre></div></div>
<p><strong>预防措施：</strong></p>
<ul>
<li class="">每完成一个功能点，执行 <code>/compact</code></li>
<li class="">避免在单次对话中处理超过 3 个大型文件</li>
<li class="">将大型任务拆分为多个子任务，分别处理</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q6代码生成质量差">Q6：代码生成质量差<a href="#q6代码生成质量差" class="hash-link" aria-label="Q6：代码生成质量差的直接链接" title="Q6：代码生成质量差的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> 生成的代码不符合项目规范，或频繁需要大量修改</p>
<p><strong>系统化改进方案：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 完善 CLAUDE.md（最有效的改进方式）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">cat &gt;&gt; CLAUDE.md &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">## 代码规范（必须遵守）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">- 使用函数式组件，禁止 class 组件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">- 所有异步操作使用 async/await，禁止 .then() 链式调用</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">- 错误处理必须使用 try/catch，禁止 .catch()</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">- 状态管理使用 Zustand，禁止直接使用 React.useState 处理全局状态</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">- 所有接口必须有 TypeScript 类型定义</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">## 代码风格示例</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">// ✅ 正确示范</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">const fetchUser = async (id: string): Promise&lt;User&gt; =&gt; {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    const response = await api.get&lt;User&gt;(`/users/${id}`);</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    return response.data;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  } catch (error) {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    throw new ApiError(&#x27;Failed to fetch user&#x27;, error);</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">};</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 使用 Plan 模式确认理解</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 让 Claude 先输出计划，确认理解正确再执行</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 按 Shift+Tab 两次进入 Plan 模式</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 提供具体示例</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">&quot;实现 fetchOrders 方法，参考 @src/services/UserService.ts 中</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"> fetchUsers 方法的实现风格和错误处理模式&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 明确约束条件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">&quot;实现订单列表组件，要求：</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"> - 使用 React.memo 优化性能</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"> - 支持虚拟滚动（使用 react-virtual 库）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"> - 骨架屏加载状态</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"> - 空状态处理</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"> - 不要使用 any 类型&quot;</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="性能问题">性能问题<a href="#性能问题" class="hash-link" aria-label="性能问题的直接链接" title="性能问题的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q7响应速度慢">Q7：响应速度慢<a href="#q7响应速度慢" class="hash-link" aria-label="Q7：响应速度慢的直接链接" title="Q7：响应速度慢的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> Claude 响应时间超过 30 秒，或频繁超时</p>
<p><strong>排查与解决：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 测试网络连接到 Anthropic API</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">curl -w &quot;@curl-format.txt&quot; -o /dev/null -s https://api.anthropic.com/v1/models \</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  -H &quot;x-api-key: $ANTHROPIC_API_KEY&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查 DNS 解析时间、连接时间、总时间</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 切换到更快的模型（响应更快，适合简单任务）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --model claude-sonnet-4-5-20250929 &quot;简单的代码问题&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># claude-sonnet 响应速度约是 claude-opus 的 3 倍</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 优化提示词，减少不必要的复杂度</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 避免：</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">&quot;请详细分析整个项目的所有可能问题...&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 改为：</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">&quot;分析 @src/auth.ts 中 login 方法的潜在 Bug&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 减少上下文大小</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/context    # 查看当前使用量</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/compact    # 如果超过 50%，立即压缩</span><br></span></code></pre></div></div>
<p><strong>网络优化（可选）：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 如果在中国大陆，配置代理</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">export HTTPS_PROXY=http://127.0.0.1:7890</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">export HTTP_PROXY=http://127.0.0.1:7890</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 或在 settings.json 中配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;proxy&quot;: &quot;http://127.0.0.1:7890&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="q8token-消耗过快">Q8：Token 消耗过快<a href="#q8token-消耗过快" class="hash-link" aria-label="Q8：Token 消耗过快的直接链接" title="Q8：Token 消耗过快的直接链接" translate="no">​</a></h4>
<p><strong>症状：</strong> 账单超出预期，或频繁触发速率限制</p>
<p><strong>Token 消耗诊断：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 1. 查看当前会话 Token 消耗</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/cost</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出：本次会话消耗的 Token 数和估算费用</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 2. 使用 /compact 减少历史 Token</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/compact</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 效果：通常可以减少 40-60% 的上下文 Token</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 3. 新任务开始时彻底清空</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/clear</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 避免将上一个任务的上下文带入新任务</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 4. 简单任务使用便宜的模型</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --model claude-haiku-20240307 &quot;格式化这段代码&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># Haiku 价格约是 Opus 的 1/20</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 5. 监控使用量</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/usage</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 查看今日/本月消耗，设置预算提醒</span><br></span></code></pre></div></div>
<p><strong>Token 使用率优化对照：</strong></p>



































<table><thead><tr><th>场景</th><th>高消耗方式</th><th>低消耗方式</th><th>节省比例</th></tr></thead><tbody><tr><td>文件引用</td><td><code>@src/</code> 整个目录</td><td><code>@src/auth.ts</code> 单文件</td><td>70-90%</td></tr><tr><td>任务切换</td><td>继续之前的对话</td><td><code>/clear</code> 后新开始</td><td>30-50%</td></tr><tr><td>模型选择</td><td>全程使用 Opus</td><td>按任务选择模型</td><td>60-80%</td></tr><tr><td>上下文管理</td><td>从不清理</td><td>定期 <code>/compact</code></td><td>40-60%</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="调试技巧">调试技巧<a href="#调试技巧" class="hash-link" aria-label="调试技巧的直接链接" title="调试技巧的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="启用调试模式">启用调试模式<a href="#启用调试模式" class="hash-link" aria-label="启用调试模式的直接链接" title="启用调试模式的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 启用完整调试输出</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">export CLAUDE_DEBUG=true</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 设置日志级别（debug/info/warn/error）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">export CLAUDE_LOG_LEVEL=debug</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 指定日志输出文件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">export CLAUDE_LOG_FILE=~/.claude/debug.log</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 启动后查看详细日志</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">tail -f ~/.claude/debug.log</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="常用诊断命令">常用诊断命令<a href="#常用诊断命令" class="hash-link" aria-label="常用诊断命令的直接链接" title="常用诊断命令的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 全面健康检查</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude /doctor</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查项目：Node 版本、API 连接、MCP 状态、权限配置、文件系统</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 查看版本信息</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude --version</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查 API Key 有效性</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude /status</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出：API Key 状态、使用的模型、当前配额</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 查看所有配置</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude /config</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 输出：所有有效的配置项及其来源（全局/项目/环境变量）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 重置到默认配置（谨慎使用）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">claude /reset --confirm</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="日志分析技巧">日志分析技巧<a href="#日志分析技巧" class="hash-link" aria-label="日志分析技巧的直接链接" title="日志分析技巧的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 查找错误日志</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">grep &quot;ERROR\|FATAL&quot; ~/.claude/debug.log | tail -50</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 查看 API 请求统计</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">grep &quot;API request&quot; ~/.claude/debug.log | wc -l</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 分析 Token 消耗峰值</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">grep &quot;tokens_used&quot; ~/.claude/debug.log | awk &#x27;{print $NF}&#x27; | sort -n | tail -10</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 清理旧日志（日志可能很大）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">find ~/.claude/logs -name &quot;*.log&quot; -mtime +7 -delete</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提交 Bug 报告时的必要信息</div><div class="admonitionContent_BuS1"><p>向 Anthropic 提交 Bug 时，请附上：<code>claude --version</code> 输出、<code>/doctor</code> 报告、相关错误日志（去除敏感信息）、操作系统和 Node.js 版本。这些信息能大幅加速问题定位。</p></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全审计清单">安全审计清单<a href="#安全审计清单" class="hash-link" aria-label="安全审计清单的直接链接" title="安全审计清单的直接链接" translate="no">​</a></h2>
<p>在正式使用 Claude Code 之前，按此清单完成安全配置：</p>


















































<table><thead><tr><th>检查项</th><th>命令/操作</th><th>状态</th></tr></thead><tbody><tr><td>权限配置已设置</td><td>查看 <code>.claude/settings.json</code></td><td>[ ]</td></tr><tr><td>危险命令已列入黑名单</td><td><code>permissions.deny.bash</code></td><td>[ ]</td></tr><tr><td>敏感路径已保护</td><td><code>permissions.deny.write</code></td><td>[ ]</td></tr><tr><td><code>.env</code> 在 <code>.gitignore</code> 中</td><td>`cat .gitignore</td><td>grep env`</td></tr><tr><td>Pre-execution Hook 已配置</td><td><code>cat .claude/hooks/security-check.sh</code></td><td>[ ]</td></tr><tr><td>MCP 服务器权限已最小化</td><td><code>/mcp</code> 检查各服务器权限</td><td>[ ]</td></tr><tr><td>CLAUDE.md 不含敏感信息</td><td>人工检查</td><td>[ ]</td></tr><tr><td>日志文件不含 API Key</td><td><code>grep -r &quot;sk-ant&quot; ~/.claude/logs/</code></td><td>[ ]</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>定期安全审计</div><div class="admonitionContent_BuS1"><p>建议每月执行一次安全审计，特别是在添加新的 MCP 服务器或修改权限配置后。随着 Claude Code 功能更新，安全最佳实践也会相应演进。</p></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/claude-doc/docs/best-practices/performance"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">性能优化</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/claude-doc/docs/category/真实场景案例库"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">真实场景案例库</div></a></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#安全配置" class="table-of-contents__link toc-highlight">安全配置</a><ul><li><a href="#sandbox-模式" class="table-of-contents__link toc-highlight">Sandbox 模式</a></li><li><a href="#最小权限原则配置示例" class="table-of-contents__link toc-highlight">最小权限原则配置示例</a></li><li><a href="#hooks-安全检查" class="table-of-contents__link toc-highlight">Hooks 安全检查</a></li><li><a href="#敏感信息保护" class="table-of-contents__link toc-highlight">敏感信息保护</a></li></ul></li><li><a href="#常见问题与解决" class="table-of-contents__link toc-highlight">常见问题与解决</a><ul><li><a href="#安装问题" class="table-of-contents__link toc-highlight">安装问题</a></li><li><a href="#配置问题" class="table-of-contents__link toc-highlight">配置问题</a></li><li><a href="#使用问题" class="table-of-contents__link toc-highlight">使用问题</a></li><li><a href="#性能问题" class="table-of-contents__link toc-highlight">性能问题</a></li></ul></li><li><a href="#调试技巧" class="table-of-contents__link toc-highlight">调试技巧</a><ul><li><a href="#启用调试模式" class="table-of-contents__link toc-highlight">启用调试模式</a></li><li><a href="#常用诊断命令" class="table-of-contents__link toc-highlight">常用诊断命令</a></li><li><a href="#日志分析技巧" class="table-of-contents__link toc-highlight">日志分析技巧</a></li></ul></li><li><a href="#安全审计清单" class="table-of-contents__link toc-highlight">安全审计清单</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Claude Docs.</div></div></div></footer></div>
</body>
</html>