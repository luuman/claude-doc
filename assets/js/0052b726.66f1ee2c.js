"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[9407],{80469(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"advanced-features/agent-sdk","title":"Claude Agent SDK","description":"\u5c06 Claude Code \u7684\u6838\u5fc3\u80fd\u529b\u4f5c\u4e3a SDK \u8c03\u7528\uff0c\u6784\u5efa\u81ea\u5b9a\u4e49 AI Agent \u548c\u81ea\u52a8\u5316\u5de5\u4f5c\u6d41","source":"@site/content/claude/docs/advanced-features/agent-sdk.md","sourceDirName":"advanced-features","slug":"/advanced-features/agent-sdk","permalink":"/claude-doc/docs/advanced-features/agent-sdk","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Claude Agent SDK","description":"\u5c06 Claude Code \u7684\u6838\u5fc3\u80fd\u529b\u4f5c\u4e3a SDK \u8c03\u7528\uff0c\u6784\u5efa\u81ea\u5b9a\u4e49 AI Agent \u548c\u81ea\u52a8\u5316\u5de5\u4f5c\u6d41"},"sidebar":"tutorialSidebar","previous":{"title":"\u81ea\u5b9a\u4e49\u659c\u6760\u547d\u4ee4","permalink":"/claude-doc/docs/advanced-features/slash-commands"},"next":{"title":"IDE \u96c6\u6210","permalink":"/claude-doc/docs/advanced-features/ide-integration"}}');var r=t(74848),o=t(28453);const i={sidebar_position:4,title:"Claude Agent SDK",description:"\u5c06 Claude Code \u7684\u6838\u5fc3\u80fd\u529b\u4f5c\u4e3a SDK \u8c03\u7528\uff0c\u6784\u5efa\u81ea\u5b9a\u4e49 AI Agent \u548c\u81ea\u52a8\u5316\u5de5\u4f5c\u6d41"},a="Claude Agent SDK",c={},l=[{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:2},{value:"\u6838\u5fc3\u80fd\u529b\u4ee3\u7801\u793a\u4f8b",id:"\u6838\u5fc3\u80fd\u529b\u4ee3\u7801\u793a\u4f8b",level:2},{value:"\u57fa\u7840 Agent \u521b\u5efa",id:"\u57fa\u7840-agent-\u521b\u5efa",level:3},{value:"\u6848\u4f8b 1\uff1a\u81ea\u52a8\u5316\u6d4b\u8bd5\u751f\u6210\u5668",id:"\u6848\u4f8b-1\u81ea\u52a8\u5316\u6d4b\u8bd5\u751f\u6210\u5668",level:2},{value:"\u6848\u4f8b 2\uff1a\u4ee3\u7801\u5ba1\u67e5\u673a\u5668\u4eba",id:"\u6848\u4f8b-2\u4ee3\u7801\u5ba1\u67e5\u673a\u5668\u4eba",level:2},{value:"\u6848\u4f8b 3\uff1a\u81ea\u52a8\u5316\u90e8\u7f72\u52a9\u624b",id:"\u6848\u4f8b-3\u81ea\u52a8\u5316\u90e8\u7f72\u52a9\u624b",level:2},{value:"\u6838\u5fc3\u4f18\u52bf",id:"\u6838\u5fc3\u4f18\u52bf",level:2},{value:"1. \u5b8c\u6574\u7684 Agent Loop",id:"1-\u5b8c\u6574\u7684-agent-loop",level:3},{value:"2. \u5f3a\u5927\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406",id:"2-\u5f3a\u5927\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406",level:3},{value:"3. \u7075\u6d3b\u7684\u5de5\u5177\u7cfb\u7edf",id:"3-\u7075\u6d3b\u7684\u5de5\u5177\u7cfb\u7edf",level:3},{value:"4. \u5b8c\u6574\u7684\u53ef\u89c2\u6d4b\u6027",id:"4-\u5b8c\u6574\u7684\u53ef\u89c2\u6d4b\u6027",level:3},{value:"\u4f7f\u7528\u573a\u666f",id:"\u4f7f\u7528\u573a\u666f",level:2}];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"claude-agent-sdk",children:"Claude Agent SDK"})}),"\n",(0,r.jsx)(e.admonition,{title:"\u4ec0\u4e48\u662f Agent SDK",type:"tip",children:(0,r.jsxs)(e.p,{children:["Claude Agent SDK \u5c06 Claude Code \u7684\u5e95\u5c42\u6838\u5fc3\u80fd\u529b\u2014\u2014",(0,r.jsx)(e.strong,{children:"Agent Loop"}),"\u3001",(0,r.jsx)(e.strong,{children:"\u5de5\u5177\u7ba1\u7406"}),"\u3001",(0,r.jsx)(e.strong,{children:"\u4e0a\u4e0b\u6587\u7ba1\u7406"}),"\u2014\u2014\u5f00\u653e\u4e3a\u53ef\u7f16\u7a0b\u7684 SDK \u63a5\u53e3\u3002\u5f00\u53d1\u8005\u4e0d\u518d\u9700\u8981\u4ece\u96f6\u5b9e\u73b0 AI Agent \u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u800c\u662f\u76f4\u63a5\u5728\u8fd9\u4e9b\u80fd\u529b\u4e4b\u4e0a\u6784\u5efa\u4e1a\u52a1\u903b\u8f91\u3002"]})}),"\n",(0,r.jsx)(e.h2,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,r.jsx)(e.p,{children:"Claude Agent SDK \u7684\u67b6\u6784\u7531\u4e09\u4e2a\u6838\u5fc3\u5c42\u6b21\u7ec4\u6210\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u4f60\u7684\u4e1a\u52a1\u903b\u8f91\uff08Custom Agent\uff09         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   Agent Loop   \u2502   \u5de5\u5177\u7ba1\u7406   \u2502   \u4e0a\u4e0b\u6587\u7ba1\u7406     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              Claude API\uff08\u5e95\u5c42\u6a21\u578b\uff09               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Agent Loop\uff08\u667a\u80fd\u4f53\u5faa\u73af\uff09"}),'\nClaude \u7684\u6838\u5fc3\u6267\u884c\u5f15\u64ce\uff0c\u9a71\u52a8"\u601d\u8003 \u2192 \u5de5\u5177\u8c03\u7528 \u2192 \u89c2\u5bdf \u2192 \u8fed\u4ee3"\u7684\u5faa\u73af\uff0c\u76f4\u5230\u4efb\u52a1\u5b8c\u6210\u3002']}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u5de5\u5177\u7ba1\u7406\uff08Tool Management\uff09"}),"\n\u5b9a\u4e49 Agent \u80fd\u591f\u4f7f\u7528\u54ea\u4e9b\u5de5\u5177\uff08\u6587\u4ef6\u8bfb\u5199\u3001Shell \u547d\u4ee4\u3001HTTP \u8bf7\u6c42\u7b49\uff09\uff0cSDK \u8d1f\u8d23\u5de5\u5177\u8c03\u7528\u7684\u7f16\u6392\u548c\u7ed3\u679c\u5904\u7406\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u4e0a\u4e0b\u6587\u7ba1\u7406\uff08Context Management\uff09"}),"\n\u81ea\u52a8\u7ba1\u7406\u5bf9\u8bdd\u5386\u53f2\u3001\u538b\u7f29\u8d85\u957f\u4e0a\u4e0b\u6587\u3001\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u786e\u4fdd Agent \u59cb\u7ec8\u5728\u6709\u6548\u7684\u4e0a\u4e0b\u6587\u7a97\u53e3\u5185\u5de5\u4f5c\u3002"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6838\u5fc3\u80fd\u529b\u4ee3\u7801\u793a\u4f8b",children:"\u6838\u5fc3\u80fd\u529b\u4ee3\u7801\u793a\u4f8b"}),"\n",(0,r.jsx)(e.h3,{id:"\u57fa\u7840-agent-\u521b\u5efa",children:"\u57fa\u7840 Agent \u521b\u5efa"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",metastring:'title="src/agent-basic.ts"',children:"import { Agent, Tool, Context } from '@anthropic-ai/claude-code-sdk';\n\n// \u5b9a\u4e49\u5de5\u5177\uff1a\u6587\u4ef6\u8bfb\u53d6\nconst readFileTool = new Tool({\n  name: 'read_file',\n  description: '\u8bfb\u53d6\u6307\u5b9a\u8def\u5f84\u7684\u6587\u4ef6\u5185\u5bb9',\n  parameters: {\n    type: 'object',\n    properties: {\n      path: {\n        type: 'string',\n        description: '\u6587\u4ef6\u8def\u5f84\uff08\u76f8\u5bf9\u6216\u7edd\u5bf9\u8def\u5f84\uff09'\n      },\n      encoding: {\n        type: 'string',\n        enum: ['utf-8', 'base64'],\n        default: 'utf-8'\n      }\n    },\n    required: ['path']\n  },\n  execute: async ({ path, encoding = 'utf-8' }) => {\n    const fs = await import('fs/promises');\n    const content = await fs.readFile(path, encoding as BufferEncoding);\n    return { content, path, size: content.length };\n  }\n});\n\n// \u5b9a\u4e49\u5de5\u5177\uff1aShell \u547d\u4ee4\u6267\u884c\nconst shellTool = new Tool({\n  name: 'run_command',\n  description: '\u6267\u884c Shell \u547d\u4ee4\u5e76\u8fd4\u56de\u8f93\u51fa',\n  parameters: {\n    type: 'object',\n    properties: {\n      command: { type: 'string', description: '\u8981\u6267\u884c\u7684\u547d\u4ee4' },\n      cwd: { type: 'string', description: '\u5de5\u4f5c\u76ee\u5f55\uff08\u53ef\u9009\uff09' }\n    },\n    required: ['command']\n  },\n  execute: async ({ command, cwd = process.cwd() }) => {\n    const { exec } = await import('child_process');\n    const { promisify } = await import('util');\n    const execAsync = promisify(exec);\n\n    try {\n      const { stdout, stderr } = await execAsync(command, { cwd });\n      return { success: true, stdout, stderr, exitCode: 0 };\n    } catch (error: any) {\n      return { success: false, stdout: '', stderr: error.message, exitCode: 1 };\n    }\n  }\n});\n\n// \u521b\u5efa\u4e0a\u4e0b\u6587\u914d\u7f6e\nconst context = new Context({\n  maxSize: 100_000,        // \u6700\u5927 token \u6570\n  compression: 'auto',     // \u81ea\u52a8\u538b\u7f29\u7b56\u7565\n  priority: 'recent',      // \u4f18\u5148\u4fdd\u7559\u6700\u8fd1\u5185\u5bb9\n  systemPrompt: `\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u4ee3\u7801\u5206\u6790\u52a9\u624b\u3002\n\u4f60\u7684\u76ee\u6807\u662f\u5e2e\u52a9\u5f00\u53d1\u8005\u7406\u89e3\u548c\u6539\u8fdb\u4ee3\u7801\u8d28\u91cf\u3002\n\u59cb\u7ec8\u63d0\u4f9b\u5177\u4f53\u3001\u53ef\u64cd\u4f5c\u7684\u5efa\u8bae\u3002`\n});\n\n// \u521b\u5efa\u5e76\u8fd0\u884c\u57fa\u7840 Agent\nconst agent = new Agent({\n  model: 'claude-opus-4-5',\n  tools: [readFileTool, shellTool],\n  context,\n  maxIterations: 10,\n  onThink: (thought) => console.log('\u601d\u8003\u4e2d:', thought.slice(0, 100) + '...'),\n  onToolUse: (tool, input) => console.log(`\u5de5\u5177\u8c03\u7528: ${tool}(${JSON.stringify(input)})`),\n  onError: (error) => console.error('\u9519\u8bef:', error.message),\n  onComplete: (result) => console.log('\u5b8c\u6210:', result.summary)\n});\n\nconst result = await agent.run('\u5206\u6790 src/ \u76ee\u5f55\u7684\u6574\u4f53\u4ee3\u7801\u8d28\u91cf');\nconsole.log(result.output);\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6848\u4f8b-1\u81ea\u52a8\u5316\u6d4b\u8bd5\u751f\u6210\u5668",children:"\u6848\u4f8b 1\uff1a\u81ea\u52a8\u5316\u6d4b\u8bd5\u751f\u6210\u5668"}),"\n",(0,r.jsx)(e.p,{children:"\u5c06\u6d4b\u8bd5\u751f\u6210\u80fd\u529b\u5c01\u88c5\u4e3a\u53ef\u590d\u7528\u7684 Agent\uff0c\u81ea\u52a8\u4e3a\u4efb\u610f\u6e90\u6587\u4ef6\u751f\u6210\u5bf9\u5e94\u7684\u6d4b\u8bd5\u7528\u4f8b\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",metastring:'title="src/agents/test-generator.ts"',children:"import { Agent, Tool } from '@anthropic-ai/claude-code-sdk';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nclass TestGenerator extends Agent {\n  private sourceDir: string;\n  private testDir: string;\n  private framework: 'jest' | 'vitest' | 'mocha';\n\n  constructor(options: {\n    sourceDir: string;\n    testDir: string;\n    framework?: 'jest' | 'vitest' | 'mocha';\n  }) {\n    const readSourceTool = new Tool({\n      name: 'read_source',\n      description: '\u8bfb\u53d6\u6e90\u4ee3\u7801\u6587\u4ef6\uff0c\u8fd4\u56de\u5185\u5bb9\u548c\u5143\u4fe1\u606f',\n      parameters: {\n        type: 'object',\n        properties: {\n          filePath: { type: 'string', description: '\u6e90\u6587\u4ef6\u8def\u5f84' }\n        },\n        required: ['filePath']\n      },\n      execute: async ({ filePath }: { filePath: string }) => {\n        const absolutePath = path.resolve(options.sourceDir, filePath);\n        const content = await fs.readFile(absolutePath, 'utf-8');\n        const stats = await fs.stat(absolutePath);\n\n        // \u63d0\u53d6\u51fd\u6570\u548c\u7c7b\u7684\u7b7e\u540d\uff08\u8f85\u52a9 Claude \u7406\u89e3\u7ed3\u6784\uff09\n        const functionMatches = content.match(/(?:export\\s+)?(?:async\\s+)?function\\s+\\w+/g) || [];\n        const classMatches = content.match(/(?:export\\s+)?class\\s+\\w+/g) || [];\n\n        return {\n          content,\n          filePath: absolutePath,\n          size: stats.size,\n          functions: functionMatches,\n          classes: classMatches,\n          lines: content.split('\\n').length\n        };\n      }\n    });\n\n    const writeTestTool = new Tool({\n      name: 'write_test',\n      description: '\u5c06\u751f\u6210\u7684\u6d4b\u8bd5\u4ee3\u7801\u5199\u5165\u5bf9\u5e94\u7684\u6d4b\u8bd5\u6587\u4ef6',\n      parameters: {\n        type: 'object',\n        properties: {\n          sourcePath: { type: 'string', description: '\u5bf9\u5e94\u7684\u6e90\u6587\u4ef6\u8def\u5f84' },\n          testContent: { type: 'string', description: '\u6d4b\u8bd5\u4ee3\u7801\u5185\u5bb9' },\n          overwrite: { type: 'boolean', description: '\u662f\u5426\u8986\u76d6\u5df2\u6709\u6d4b\u8bd5\u6587\u4ef6', default: false }\n        },\n        required: ['sourcePath', 'testContent']\n      },\n      execute: async ({ sourcePath, testContent, overwrite = false }) => {\n        // \u751f\u6210\u6d4b\u8bd5\u6587\u4ef6\u8def\u5f84\uff08src/utils/parser.ts \u2192 tests/utils/parser.test.ts\uff09\n        const relative = path.relative(options.sourceDir, sourcePath);\n        const testPath = path.join(\n          options.testDir,\n          relative.replace(/\\.(ts|js|tsx|jsx)$/, '.test.$1')\n        );\n\n        // \u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5df2\u5b58\u5728\n        const exists = await fs.access(testPath).then(() => true).catch(() => false);\n        if (exists && !overwrite) {\n          return { success: false, reason: '\u6d4b\u8bd5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u8bbe\u7f6e overwrite=true \u8986\u76d6' };\n        }\n\n        // \u786e\u4fdd\u76ee\u5f55\u5b58\u5728\n        await fs.mkdir(path.dirname(testPath), { recursive: true });\n        await fs.writeFile(testPath, testContent, 'utf-8');\n\n        return { success: true, testPath, linesWritten: testContent.split('\\n').length };\n      }\n    });\n\n    const runTestsTool = new Tool({\n      name: 'run_tests',\n      description: '\u8fd0\u884c\u6307\u5b9a\u7684\u6d4b\u8bd5\u6587\u4ef6\u5e76\u8fd4\u56de\u7ed3\u679c',\n      parameters: {\n        type: 'object',\n        properties: {\n          testFile: { type: 'string', description: '\u6d4b\u8bd5\u6587\u4ef6\u8def\u5f84\uff08\u53ef\u9009\uff0c\u4e0d\u6307\u5b9a\u5219\u8fd0\u884c\u5168\u90e8\uff09' }\n        }\n      },\n      execute: async ({ testFile }: { testFile?: string }) => {\n        const framework = options.framework || 'jest';\n        const cmd = testFile\n          ? `npx ${framework} ${testFile} --no-coverage`\n          : `npx ${framework} --no-coverage`;\n\n        try {\n          const { stdout, stderr } = await execAsync(cmd, {\n            cwd: process.cwd(),\n            timeout: 60_000\n          });\n          return { passed: true, output: stdout, errors: stderr };\n        } catch (error: any) {\n          return { passed: false, output: error.stdout || '', errors: error.stderr || error.message };\n        }\n      }\n    });\n\n    super({\n      model: 'claude-opus-4-5',\n      tools: [readSourceTool, writeTestTool, runTestsTool],\n      maxIterations: 20,\n      systemPrompt: `\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u6d4b\u8bd5\u5de5\u7a0b\u5e08\uff0c\u64c5\u957f\u4e3a TypeScript/JavaScript \u4ee3\u7801\u7f16\u5199\u9ad8\u8d28\u91cf\u7684\u5355\u5143\u6d4b\u8bd5\u3002\n\n\u4f7f\u7528 ${options.framework || 'jest'} \u6d4b\u8bd5\u6846\u67b6\u3002\n\n\u6d4b\u8bd5\u8981\u6c42\uff1a\n1. \u6d4b\u8bd5\u8986\u76d6\u6b63\u5e38\u8def\u5f84\u3001\u8fb9\u754c\u60c5\u51b5\u548c\u5f02\u5e38\u60c5\u51b5\n2. \u4f7f\u7528\u63cf\u8ff0\u6027\u7684\u6d4b\u8bd5\u540d\u79f0\uff08describe/it/test \u5757\uff09\n3. Mock \u5916\u90e8\u4f9d\u8d56\uff08HTTP \u8bf7\u6c42\u3001\u6587\u4ef6 I/O\u3001\u6570\u636e\u5e93\uff09\n4. \u6bcf\u4e2a\u51fd\u6570\u81f3\u5c11 3 \u4e2a\u6d4b\u8bd5\u7528\u4f8b\n5. \u751f\u6210\u6d4b\u8bd5\u540e\u8fd0\u884c\u9a8c\u8bc1\uff0c\u4fee\u590d\u5931\u8d25\u7684\u6d4b\u8bd5`\n    });\n\n    this.sourceDir = options.sourceDir;\n    this.testDir = options.testDir;\n    this.framework = options.framework || 'jest';\n  }\n\n  async generateForFile(filePath: string): Promise<{ testPath: string; coverage: number }> {\n    const result = await this.run(\n      `\u4e3a\u6587\u4ef6 ${filePath} \u751f\u6210\u5b8c\u6574\u7684\u6d4b\u8bd5\u5957\u4ef6\u3002\n      \u6b65\u9aa4\uff1a1) \u8bfb\u53d6\u6e90\u6587\u4ef6  2) \u5206\u6790\u6240\u6709\u5bfc\u51fa  3) \u751f\u6210\u6d4b\u8bd5\u4ee3\u7801  4) \u5199\u5165\u6d4b\u8bd5\u6587\u4ef6  5) \u8fd0\u884c\u6d4b\u8bd5\u786e\u8ba4\u901a\u8fc7`\n    );\n\n    return {\n      testPath: result.metadata?.testPath as string,\n      coverage: result.metadata?.coverage as number || 0\n    };\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst generator = new TestGenerator({\n  sourceDir: './src',\n  testDir: './tests',\n  framework: 'jest'\n});\n\nawait generator.generateForFile('utils/parser.ts');\nawait generator.generateForFile('services/auth.ts');\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6848\u4f8b-2\u4ee3\u7801\u5ba1\u67e5\u673a\u5668\u4eba",children:"\u6848\u4f8b 2\uff1a\u4ee3\u7801\u5ba1\u67e5\u673a\u5668\u4eba"}),"\n",(0,r.jsx)(e.p,{children:"\u81ea\u52a8\u8fdb\u884c\u4ee3\u7801\u5ba1\u67e5\uff0c\u8f93\u51fa\u7ed3\u6784\u5316\u7684\u5ba1\u67e5\u62a5\u544a\uff0c\u53ef\u96c6\u6210\u5230 CI/CD \u6d41\u6c34\u7ebf\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",metastring:'title="src/agents/code-reviewer.ts"',children:"import { Agent, Tool } from '@anthropic-ai/claude-code-sdk';\nimport * as fs from 'fs/promises';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\ninterface ReviewReport {\n  overall: 'approve' | 'request_changes' | 'comment';\n  score: number;           // 1-10\n  summary: string;\n  issues: ReviewIssue[];\n  suggestions: string[];\n  positives: string[];\n}\n\ninterface ReviewIssue {\n  severity: 'critical' | 'major' | 'minor' | 'info';\n  file: string;\n  line?: number;\n  message: string;\n  suggestion?: string;\n}\n\nclass CodeReviewer extends Agent {\n  constructor() {\n    const readFileTool = new Tool({\n      name: 'read_file',\n      description: '\u8bfb\u53d6\u6307\u5b9a\u6587\u4ef6\u7684\u5185\u5bb9',\n      parameters: {\n        type: 'object',\n        properties: {\n          path: { type: 'string' },\n          startLine: { type: 'number', description: '\u5f00\u59cb\u884c\uff08\u53ef\u9009\uff09' },\n          endLine: { type: 'number', description: '\u7ed3\u675f\u884c\uff08\u53ef\u9009\uff09' }\n        },\n        required: ['path']\n      },\n      execute: async ({ path, startLine, endLine }: {\n        path: string;\n        startLine?: number;\n        endLine?: number;\n      }) => {\n        const content = await fs.readFile(path, 'utf-8');\n        if (startLine !== undefined && endLine !== undefined) {\n          const lines = content.split('\\n');\n          return lines.slice(startLine - 1, endLine).join('\\n');\n        }\n        return content;\n      }\n    });\n\n    const gitDiffTool = new Tool({\n      name: 'git_diff',\n      description: '\u83b7\u53d6 Git \u5dee\u5f02\uff0c\u652f\u6301\u6bd4\u8f83\u5206\u652f\u6216\u63d0\u4ea4',\n      parameters: {\n        type: 'object',\n        properties: {\n          base: { type: 'string', description: '\u57fa\u7840\u5206\u652f\u6216\u63d0\u4ea4\uff08\u9ed8\u8ba4: main\uff09' },\n          head: { type: 'string', description: '\u76ee\u6807\u5206\u652f\u6216\u63d0\u4ea4\uff08\u9ed8\u8ba4: HEAD\uff09' },\n          file: { type: 'string', description: '\u4ec5\u663e\u793a\u7279\u5b9a\u6587\u4ef6\u7684\u5dee\u5f02\uff08\u53ef\u9009\uff09' }\n        }\n      },\n      execute: async ({ base = 'main', head = 'HEAD', file }: {\n        base?: string;\n        head?: string;\n        file?: string;\n      }) => {\n        const fileArg = file ? `-- ${file}` : '';\n        const { stdout } = await execAsync(\n          `git diff ${base}...${head} ${fileArg}`,\n          { maxBuffer: 10 * 1024 * 1024 }\n        );\n        return stdout;\n      }\n    });\n\n    super({\n      model: 'claude-opus-4-5',\n      tools: [readFileTool, gitDiffTool],\n      maxIterations: 15,\n      systemPrompt: `\u4f60\u662f\u4e00\u4f4d\u8d44\u6df1\u8f6f\u4ef6\u5de5\u7a0b\u5e08\uff0c\u8d1f\u8d23\u8fdb\u884c\u4e25\u683c\u4f46\u5efa\u8bbe\u6027\u7684\u4ee3\u7801\u5ba1\u67e5\u3002\n\n\u5ba1\u67e5\u91cd\u70b9\uff1a\n1. \u6b63\u786e\u6027\uff1a\u903b\u8f91\u9519\u8bef\u3001\u8fb9\u754c\u6761\u4ef6\u3001\u7ade\u6001\u6761\u4ef6\n2. \u5b89\u5168\u6027\uff1aSQL \u6ce8\u5165\u3001XSS\u3001\u4e0d\u5b89\u5168\u7684\u53cd\u5e8f\u5217\u5316\u3001\u786c\u7f16\u7801\u5bc6\u94a5\n3. \u6027\u80fd\uff1aN+1 \u67e5\u8be2\u3001\u4e0d\u5fc5\u8981\u7684\u8ba1\u7b97\u3001\u5185\u5b58\u6cc4\u9732\n4. \u53ef\u7ef4\u62a4\u6027\uff1a\u547d\u540d\u89c4\u8303\u3001\u51fd\u6570\u804c\u8d23\u5355\u4e00\u3001\u91cd\u590d\u4ee3\u7801\n5. \u6d4b\u8bd5\u8986\u76d6\uff1a\u662f\u5426\u6709\u5bf9\u5e94\u7684\u6d4b\u8bd5\n\n\u8f93\u51fa\u683c\u5f0f\u8981\u6c42\uff1a\n- \u8f93\u51fa\u5408\u6cd5\u7684 JSON\uff0c\u5339\u914d ReviewReport \u63a5\u53e3\n- severity \u5206\u7ea7\uff1acritical\uff08\u5fc5\u987b\u4fee\u590d\uff09/ major\uff08\u5f3a\u70c8\u5efa\u8bae\uff09/ minor\uff08\u5efa\u8bae\uff09/ info\uff08\u4ec5\u4f9b\u53c2\u8003\uff09\n- overall\uff1a\u53ea\u6709\u65e0 critical/major \u95ee\u9898\u65f6\u624d\u9009 approve`\n    });\n  }\n\n  async reviewPR(baseBranch: string, headBranch: string): Promise<ReviewReport> {\n    const result = await this.run(\n      `\u5bf9\u4ee5\u4e0b PR \u8fdb\u884c\u5168\u9762\u4ee3\u7801\u5ba1\u67e5\uff1a\n      - \u57fa\u7840\u5206\u652f\uff1a${baseBranch}\n      - \u76ee\u6807\u5206\u652f\uff1a${headBranch}\n\n      \u6b65\u9aa4\uff1a\n      1. \u83b7\u53d6\u5b8c\u6574 diff\n      2. \u5bf9\u6bcf\u4e2a\u53d8\u66f4\u6587\u4ef6\u8fdb\u884c\u6df1\u5ea6\u5206\u6790\n      3. \u91cd\u70b9\u68c0\u67e5\u5b89\u5168\u6027\u548c\u903b\u8f91\u6b63\u786e\u6027\n      4. \u8f93\u51fa\u7b26\u5408 ReviewReport \u683c\u5f0f\u7684 JSON \u5ba1\u67e5\u62a5\u544a`\n    );\n\n    try {\n      // \u4ece\u8f93\u51fa\u4e2d\u63d0\u53d6 JSON\n      const jsonMatch = result.output.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) throw new Error('\u65e0\u6cd5\u63d0\u53d6 JSON \u62a5\u544a');\n      return JSON.parse(jsonMatch[0]) as ReviewReport;\n    } catch {\n      // \u964d\u7ea7\u5904\u7406\n      return {\n        overall: 'comment',\n        score: 5,\n        summary: result.output,\n        issues: [],\n        suggestions: [],\n        positives: []\n      };\n    }\n  }\n\n  formatReport(report: ReviewReport): string {\n    const icons = { critical: '\ud83d\udd34', major: '\ud83d\udfe0', minor: '\ud83d\udfe1', info: '\ud83d\udd35' };\n    const overall = { approve: '\u2705 \u6279\u51c6', request_changes: '\u274c \u9700\u8981\u4fee\u6539', comment: '\ud83d\udcac \u5df2\u8bc4\u8bba' };\n\n    let output = `# \u4ee3\u7801\u5ba1\u67e5\u62a5\u544a\\n\\n`;\n    output += `**\u7ed3\u8bba\uff1a** ${overall[report.overall]}\\n`;\n    output += `**\u8d28\u91cf\u8bc4\u5206\uff1a** ${report.score}/10\\n\\n`;\n    output += `## \u603b\u4f53\u8bc4\u4ef7\\n${report.summary}\\n\\n`;\n\n    if (report.issues.length > 0) {\n      output += `## \u53d1\u73b0\u7684\u95ee\u9898\\n\\n`;\n      for (const issue of report.issues) {\n        const loc = issue.line ? `${issue.file}:${issue.line}` : issue.file;\n        output += `${icons[issue.severity]} **[${issue.severity.toUpperCase()}]** \\`${loc}\\`\\n`;\n        output += `  ${issue.message}\\n`;\n        if (issue.suggestion) output += `  > \u5efa\u8bae\uff1a${issue.suggestion}\\n`;\n        output += '\\n';\n      }\n    }\n\n    if (report.positives.length > 0) {\n      output += `## \u503c\u5f97\u80af\u5b9a\\n`;\n      report.positives.forEach(p => output += `- ${p}\\n`);\n    }\n\n    return output;\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst reviewer = new CodeReviewer();\nconst report = await reviewer.reviewPR('main', 'feat/user-auth');\nconsole.log(reviewer.formatReport(report));\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6848\u4f8b-3\u81ea\u52a8\u5316\u90e8\u7f72\u52a9\u624b",children:"\u6848\u4f8b 3\uff1a\u81ea\u52a8\u5316\u90e8\u7f72\u52a9\u624b"}),"\n",(0,r.jsx)(e.p,{children:"\u5c01\u88c5\u5b8c\u6574\u7684\u90e8\u7f72\u6d41\u7a0b\uff0c\u652f\u6301\u591a\u73af\u5883\u90e8\u7f72\u3001\u81ea\u52a8\u56de\u6eda\u548c\u5b9e\u65f6\u72b6\u6001\u901a\u77e5\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",metastring:'title="src/agents/deployment-bot.ts"',children:"import { Agent, Tool, Context } from '@anthropic-ai/claude-code-sdk';\n\ntype Environment = 'staging' | 'production';\n\ninterface DeploymentResult {\n  success: boolean;\n  environment: Environment;\n  version: string;\n  duration: number;\n  rollbackTag?: string;\n}\n\nclass DeploymentBot extends Agent {\n  private environment: Environment;\n  private notificationWebhook?: string;\n\n  constructor(environment: Environment, notificationWebhook?: string) {\n    const runTestsTool = new Tool({\n      name: 'run_tests',\n      description: '\u8fd0\u884c\u6d4b\u8bd5\u5957\u4ef6\uff0c\u8fd4\u56de\u901a\u8fc7\u7387\u548c\u5931\u8d25\u7528\u4f8b',\n      parameters: {\n        type: 'object',\n        properties: {\n          suite: {\n            type: 'string',\n            enum: ['unit', 'integration', 'e2e', 'all'],\n            default: 'all'\n          }\n        }\n      },\n      execute: async ({ suite = 'all' }) => {\n        const { exec } = await import('child_process');\n        const { promisify } = await import('util');\n        const execAsync = promisify(exec);\n\n        const cmd = suite === 'all'\n          ? 'npm run test:ci'\n          : `npm run test:${suite}`;\n\n        try {\n          const { stdout } = await execAsync(cmd, { timeout: 300_000 });\n          const passMatch = stdout.match(/(\\d+) passed/);\n          const failMatch = stdout.match(/(\\d+) failed/);\n          return {\n            passed: !failMatch,\n            totalPassed: parseInt(passMatch?.[1] || '0'),\n            totalFailed: parseInt(failMatch?.[1] || '0'),\n            output: stdout.slice(-2000)  // \u6700\u540e 2000 \u5b57\u7b26\n          };\n        } catch (error: any) {\n          return { passed: false, error: error.message };\n        }\n      }\n    });\n\n    const buildTool = new Tool({\n      name: 'build',\n      description: '\u6784\u5efa\u751f\u4ea7\u5305\uff0c\u8fd4\u56de\u6784\u5efa\u4ea7\u7269\u4fe1\u606f',\n      parameters: {\n        type: 'object',\n        properties: {\n          env: { type: 'string', enum: ['staging', 'production'] }\n        },\n        required: ['env']\n      },\n      execute: async ({ env }) => {\n        const { exec } = await import('child_process');\n        const { promisify } = await import('util');\n        const execAsync = promisify(exec);\n\n        const start = Date.now();\n        await execAsync(`NODE_ENV=${env} npm run build`);\n        const duration = Date.now() - start;\n\n        const { stdout: du } = await execAsync('du -sh dist/');\n        return { success: true, size: du.split('\\t')[0], duration };\n      }\n    });\n\n    const deployTool = new Tool({\n      name: 'deploy',\n      description: '\u5c06\u6784\u5efa\u4ea7\u7269\u90e8\u7f72\u5230\u6307\u5b9a\u73af\u5883',\n      parameters: {\n        type: 'object',\n        properties: {\n          environment: { type: 'string', enum: ['staging', 'production'] },\n          dryRun: { type: 'boolean', description: '\u6f14\u4e60\u6a21\u5f0f\uff08\u4e0d\u5b9e\u9645\u90e8\u7f72\uff09', default: false }\n        },\n        required: ['environment']\n      },\n      execute: async ({ environment, dryRun = false }) => {\n        if (dryRun) {\n          return { success: true, dryRun: true, message: '\u6f14\u4e60\u6a21\u5f0f\uff1a\u90e8\u7f72\u547d\u4ee4\u9a8c\u8bc1\u901a\u8fc7' };\n        }\n        const { exec } = await import('child_process');\n        const { promisify } = await import('util');\n        const execAsync = promisify(exec);\n\n        await execAsync(`npm run deploy:${environment}`);\n        return { success: true, environment, deployedAt: new Date().toISOString() };\n      }\n    });\n\n    const verifyTool = new Tool({\n      name: 'verify',\n      description: '\u9a8c\u8bc1\u90e8\u7f72\u540e\u7684\u670d\u52a1\u5065\u5eb7\u72b6\u6001',\n      parameters: {\n        type: 'object',\n        properties: {\n          environment: { type: 'string' },\n          checks: {\n            type: 'array',\n            items: { type: 'string' },\n            description: '\u8981\u68c0\u67e5\u7684\u7aef\u70b9\u5217\u8868'\n          }\n        },\n        required: ['environment']\n      },\n      execute: async ({ environment, checks = ['/health', '/api/status'] }) => {\n        const baseUrl = environment === 'production'\n          ? process.env.PROD_URL\n          : process.env.STAGING_URL;\n\n        const results = await Promise.all(\n          checks.map(async (endpoint: string) => {\n            try {\n              const { default: fetch } = await import('node-fetch');\n              const res = await fetch(`${baseUrl}${endpoint}`, { timeout: 10_000 } as any);\n              return { endpoint, status: res.status, ok: res.ok };\n            } catch (err: any) {\n              return { endpoint, status: 0, ok: false, error: err.message };\n            }\n          })\n        );\n\n        return {\n          allPassed: results.every(r => r.ok),\n          results\n        };\n      }\n    });\n\n    const rollbackTool = new Tool({\n      name: 'rollback',\n      description: '\u56de\u6eda\u5230\u6307\u5b9a\u7248\u672c',\n      parameters: {\n        type: 'object',\n        properties: {\n          tag: { type: 'string', description: 'Git tag \u6216\u90e8\u7f72 ID' },\n          environment: { type: 'string' }\n        },\n        required: ['tag', 'environment']\n      },\n      execute: async ({ tag, environment }) => {\n        const { exec } = await import('child_process');\n        const { promisify } = await import('util');\n        const execAsync = promisify(exec);\n\n        await execAsync(`git checkout ${tag}`);\n        await execAsync(`npm run deploy:${environment}`);\n        return { success: true, rolledBackTo: tag, environment };\n      }\n    });\n\n    const notifyTool = new Tool({\n      name: 'notify',\n      description: '\u53d1\u9001\u90e8\u7f72\u72b6\u6001\u901a\u77e5\u5230 Slack/\u98de\u4e66',\n      parameters: {\n        type: 'object',\n        properties: {\n          status: { type: 'string', enum: ['started', 'success', 'failure', 'rollback'] },\n          message: { type: 'string' },\n          details: { type: 'object' }\n        },\n        required: ['status', 'message']\n      },\n      execute: async ({ status, message, details }) => {\n        if (!notificationWebhook) return { sent: false, reason: '\u672a\u914d\u7f6e webhook' };\n\n        const emoji = { started: '\ud83d\ude80', success: '\u2705', failure: '\u274c', rollback: '\u21a9\ufe0f' }[status];\n        const payload = {\n          text: `${emoji} *\u90e8\u7f72\u901a\u77e5*: ${message}`,\n          attachments: details ? [{ text: JSON.stringify(details, null, 2) }] : []\n        };\n\n        const { default: fetch } = await import('node-fetch');\n        await fetch(notificationWebhook, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n\n        return { sent: true };\n      }\n    });\n\n    const context = new Context({\n      maxSize: 80_000,\n      compression: 'auto',\n      priority: 'recent',\n      systemPrompt: `\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684 DevOps \u52a9\u624b\uff0c\u8d1f\u8d23\u5b89\u5168\u3001\u53ef\u9760\u5730\u6267\u884c\u90e8\u7f72\u6d41\u7a0b\u3002\n\n\u90e8\u7f72\u539f\u5219\uff1a\n1. \u5b89\u5168\u7b2c\u4e00\uff1a\u6d4b\u8bd5\u672a\u901a\u8fc7\u7edd\u4e0d\u90e8\u7f72\n2. \u8c28\u614e\u64cd\u4f5c\uff1a\u751f\u4ea7\u90e8\u7f72\u524d\u5fc5\u987b\u5728 Staging \u9a8c\u8bc1\n3. \u7559\u6709\u540e\u8def\uff1a\u90e8\u7f72\u524d\u521b\u5efa\u56de\u6eda\u70b9\n4. \u53ca\u65f6\u901a\u77e5\uff1a\u6bcf\u4e2a\u5173\u952e\u8282\u70b9\u901a\u77e5\u56e2\u961f\n5. \u5feb\u901f\u54cd\u5e94\uff1a\u53d1\u73b0\u95ee\u9898\u7acb\u5373\u89e6\u53d1\u56de\u6eda`\n    });\n\n    super({\n      model: 'claude-opus-4-5',\n      tools: [runTestsTool, buildTool, deployTool, verifyTool, rollbackTool, notifyTool],\n      context,\n      maxIterations: 30\n    });\n\n    this.environment = environment;\n    this.notificationWebhook = notificationWebhook;\n  }\n\n  async deploy(version: string): Promise<DeploymentResult> {\n    const startTime = Date.now();\n\n    const result = await this.run(`\n\u6267\u884c ${this.environment} \u73af\u5883\u90e8\u7f72\uff0c\u7248\u672c\uff1a${version}\n\n\u90e8\u7f72\u6d41\u7a0b\uff1a\n1. \u53d1\u9001\"\u90e8\u7f72\u5f00\u59cb\"\u901a\u77e5\n2. \u8fd0\u884c\u5b8c\u6574\u6d4b\u8bd5\u5957\u4ef6\uff08unit + integration\uff09\n3. \u5982\u6d4b\u8bd5\u901a\u8fc7\uff1a\u6784\u5efa ${this.environment} \u5305\n4. ${this.environment === 'production' ? '\u5148\u90e8\u7f72 staging \u9a8c\u8bc1\uff0c\u518d\u90e8\u7f72 production' : '\u90e8\u7f72\u5230 staging'}\n5. \u9a8c\u8bc1\u90e8\u7f72\u540e\u5065\u5eb7\u72b6\u6001\n6. \u53d1\u9001\"\u90e8\u7f72\u6210\u529f/\u5931\u8d25\"\u901a\u77e5\n7. \u5982\u5931\u8d25\uff1a\u6267\u884c\u56de\u6eda\u5e76\u901a\u77e5\n\n\u5173\u952e\u7ea6\u675f\uff1a\u4efb\u4f55\u6b65\u9aa4\u5931\u8d25\u90fd\u5fc5\u987b\u505c\u6b62\u5e76\u56de\u6eda\uff0c\u4e0d\u5141\u8bb8\u5e26\u7740\u95ee\u9898\u7ee7\u7eed\u3002\n    `);\n\n    return {\n      success: !result.output.includes('\u5931\u8d25') && !result.output.includes('\u56de\u6eda'),\n      environment: this.environment,\n      version,\n      duration: Date.now() - startTime\n    };\n  }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nconst bot = new DeploymentBot('production', process.env.SLACK_WEBHOOK);\nconst result = await bot.deploy('v2.3.1');\n\nconsole.log(`\u90e8\u7f72${result.success ? '\u6210\u529f' : '\u5931\u8d25'}`);\nconsole.log(`\u8017\u65f6\uff1a${(result.duration / 1000).toFixed(1)}s`);\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6838\u5fc3\u4f18\u52bf",children:"\u6838\u5fc3\u4f18\u52bf"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u5b8c\u6574\u7684-agent-loop",children:"1. \u5b8c\u6574\u7684 Agent Loop"}),"\n",(0,r.jsx)(e.p,{children:"Agent SDK \u5185\u7f6e\u4e86\u7ecf\u8fc7\u751f\u4ea7\u9a8c\u8bc1\u7684\u6267\u884c\u5f15\u64ce\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502         \u4efb\u52a1\u8f93\u5165             \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2193\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n             \u250c\u2500\u2500\u2500 \u2502   Thinking\uff08\u6df1\u5ea6\u601d\u8003\uff09        \u2502\n             \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502                  \u2193\n             \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n             \u2502    \u2502   Tool Use\uff08\u5de5\u5177\u8c03\u7528\uff09        \u2502\n             \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u5faa         \u2502                  \u2193\n    \u73af         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u6267         \u2502    \u2502   Observation\uff08\u7ed3\u679c\u89c2\u5bdf\uff09     \u2502\n    \u884c         \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502                  \u2193\n             \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n             \u2514\u2500\u2500\u2500 \u2502   Iteration\uff08\u51b3\u7b56\u4e0b\u4e00\u6b65\uff09     \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2193 \u4efb\u52a1\u5b8c\u6210\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502         \u7ed3\u679c\u8f93\u51fa             \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u5f3a\u5927\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406",children:"2. \u5f3a\u5927\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"const context = new Context({\n  maxSize: 100_000,          // \u6700\u5927 100K token\n  compression: 'auto',       // \u81ea\u52a8\u538b\u7f29\u7b56\u7565\n  priority: 'recent',        // \u4f18\u5148\u4fdd\u7559\u6700\u8fd1\u5185\u5bb9\n  preservePatterns: [        // \u6c38\u8fdc\u4fdd\u7559\u7684\u5185\u5bb9\u6a21\u5f0f\n    /ERROR:/,\n    /CRITICAL:/,\n    /## \u90e8\u7f72\u8ba1\u5212/\n  ],\n  onCompress: (before, after) => {\n    console.log(`\u4e0a\u4e0b\u6587\u538b\u7f29\uff1a${before} \u2192 ${after} tokens`);\n  }\n});\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u7075\u6d3b\u7684\u5de5\u5177\u7cfb\u7edf",children:"3. \u7075\u6d3b\u7684\u5de5\u5177\u7cfb\u7edf"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"// \u5de5\u5177\u53ef\u4ee5\u662f\u540c\u6b65\u6216\u5f02\u6b65\nconst syncTool = new Tool({ execute: ({ x }) => x * 2 });\n\n// \u5de5\u5177\u53ef\u4ee5\u8c03\u7528\u5916\u90e8 API\nconst apiTool = new Tool({\n  execute: async ({ endpoint }) => {\n    const res = await fetch(endpoint);\n    return res.json();\n  }\n});\n\n// \u5de5\u5177\u53ef\u4ee5\u6267\u884c Shell \u547d\u4ee4\nconst shellTool = new Tool({\n  execute: async ({ cmd }) => {\n    const { stdout } = await execAsync(cmd);\n    return stdout;\n  }\n});\n\n// \u5de5\u5177\u53ef\u4ee5\u662f\u5176\u4ed6 Agent\uff08Multi-Agent\uff09\nconst subAgent = new Agent({ ... });\nconst agentTool = new Tool({\n  execute: async ({ task }) => subAgent.run(task)\n});\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u5b8c\u6574\u7684\u53ef\u89c2\u6d4b\u6027",children:"4. \u5b8c\u6574\u7684\u53ef\u89c2\u6d4b\u6027"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"const agent = new Agent({\n  onThink: (thought, iteration) => {\n    console.log(`[\u8fed\u4ee3 ${iteration}] \u601d\u8003:`, thought.slice(0, 200));\n  },\n  onToolUse: (toolName, input, output) => {\n    console.log(`\u5de5\u5177: ${toolName}`);\n    console.log(`\u8f93\u5165:`, JSON.stringify(input).slice(0, 100));\n    console.log(`\u8f93\u51fa:`, JSON.stringify(output).slice(0, 100));\n  },\n  onError: (error, context) => {\n    console.error(`\u9519\u8bef [${context.iteration}]:`, error.message);\n    // \u53ef\u4ee5\u9009\u62e9\u91cd\u8bd5\u6216\u964d\u7ea7\u5904\u7406\n  },\n  onComplete: (result) => {\n    console.log(`\u5b8c\u6210\uff01`);\n    console.log(`- \u603b\u8fed\u4ee3\u6b21\u6570\uff1a${result.iterations}`);\n    console.log(`- \u5de5\u5177\u8c03\u7528\u6b21\u6570\uff1a${result.toolCalls}`);\n    console.log(`- Token \u6d88\u8017\uff1a${result.tokenUsage}`);\n    console.log(`- \u8017\u65f6\uff1a${result.duration}ms`);\n  }\n});\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u4f7f\u7528\u573a\u666f",children:"\u4f7f\u7528\u573a\u666f"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u573a\u666f"}),(0,r.jsx)(e.th,{children:"Agent \u793a\u4f8b"}),(0,r.jsx)(e.th,{children:"\u4e3b\u8981\u5de5\u5177"}),(0,r.jsx)(e.th,{children:"\u4ef7\u503c"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"CI/CD \u96c6\u6210"})}),(0,r.jsx)(e.td,{children:"\u4ee3\u7801\u5ba1\u67e5\u673a\u5668\u4eba\u3001\u90e8\u7f72\u52a9\u624b"}),(0,r.jsx)(e.td,{children:"gitDiff\u3001deploy\u3001notify"}),(0,r.jsx)(e.td,{children:"\u81ea\u52a8\u5316\u8d28\u91cf\u95e8\u7981\uff0c\u51cf\u5c11\u4eba\u5de5\u5e72\u9884"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"\u81ea\u52a8\u5316\u8fd0\u7ef4"})}),(0,r.jsx)(e.td,{children:"\u76d1\u63a7\u544a\u8b66\u5904\u7406\u3001\u65e5\u5fd7\u5206\u6790"}),(0,r.jsx)(e.td,{children:"readLogs\u3001callAPI\u3001runScript"}),(0,r.jsx)(e.td,{children:"7x24 \u5c0f\u65f6\u65e0\u4eba\u503c\u5b88\u54cd\u5e94"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"\u6587\u6863\u751f\u6210"})}),(0,r.jsx)(e.td,{children:"API \u6587\u6863\u751f\u6210\u5668\u3001\u53d8\u66f4\u65e5\u5fd7\u751f\u6210"}),(0,r.jsx)(e.td,{children:"readSource\u3001writeDoc\u3001gitLog"}),(0,r.jsx)(e.td,{children:"\u6587\u6863\u4e0e\u4ee3\u7801\u59cb\u7ec8\u540c\u6b65"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"\u4ee3\u7801\u8fc1\u79fb"})}),(0,r.jsx)(e.td,{children:"\u6846\u67b6\u5347\u7ea7\u52a9\u624b\u3001\u4f9d\u8d56\u8fc1\u79fb\u5de5\u5177"}),(0,r.jsx)(e.td,{children:"readFile\u3001writeFile\u3001runTests"}),(0,r.jsx)(e.td,{children:"\u5927\u89c4\u6a21\u4ee3\u7801\u53d8\u66f4\u7684\u5b89\u5168\u6267\u884c"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"\u6559\u5b66\u5de5\u5177"})}),(0,r.jsx)(e.td,{children:"\u4ee3\u7801\u8bb2\u89e3\u52a9\u624b\u3001\u7ec3\u4e60\u751f\u6210\u5668"}),(0,r.jsx)(e.td,{children:"readFile\u3001explainCode"}),(0,r.jsx)(e.td,{children:"\u4e2a\u6027\u5316\u5b66\u4e60\u4f53\u9a8c"})]})]})]}),"\n",(0,r.jsxs)(e.admonition,{title:"\u6ce8\u610f\u4e8b\u9879",type:"note",children:[(0,r.jsx)(e.p,{children:"Agent SDK \u76ee\u524d\u5904\u4e8e\u65e9\u671f\u8bbf\u95ee\u9636\u6bb5\uff0cAPI \u53ef\u80fd\u53d1\u751f\u53d8\u5316\u3002\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u524d\uff0c\u5efa\u8bae\u9501\u5b9a\u4f9d\u8d56\u7248\u672c\u5e76\u5145\u5206\u6d4b\u8bd5\u3002"}),(0,r.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"--dangerously-skip-permissions"})," \u6216 SDK \u7684 ",(0,r.jsx)(e.code,{children:"skipPermissions: true"})," \u65f6\uff0c\u8bf7\u786e\u4fdd Agent \u8fd0\u884c\u5728\u53d7\u63a7\u73af\u5883\u4e2d\uff0c\u907f\u514d\u8bef\u64cd\u4f5c\u751f\u4ea7\u6570\u636e\u3002"]})]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},28453(n,e,t){t.d(e,{R:()=>i,x:()=>a});var s=t(96540);const r={},o=s.createContext(r);function i(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);